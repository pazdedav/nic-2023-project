[{
// Synopsis: This policy enables you to restrict the locations your organization can specify when deploying resources. Use to enforce your geo-compliance requirements. Excludes resource groups, Microsoft.AzureActiveDirectory/b2cDirectories, and resources that use the 'global' region.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.67401da3f0d7","displayName":"Allowed locations","tags":{"Azure.Policy/category":"General"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/e56962a6-4747-49cd-b67b-bf8b01975c4c","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"This policy enables you to restrict the locations your organization can specify when deploying resources. Use to enforce your geo-compliance requirements. Excludes resource groups, Microsoft.AzureActiveDirectory/b2cDirectories, and resources that use the 'global' region.","with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"location","notIn":["global","norwayeast","norwaywest","westeurope"]},{"field":"location","notEquals":"global"},{"notEquals":"Microsoft.AzureActiveDirectory/b2cDirectories","type":"."}]},"condition":{"value":"deny","equals":false}}},{
// Synopsis: Enforces existence of a tag on resource groups.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.c912eed91c13","displayName":"Require a tag on resource groups","tags":{"Azure.Policy/category":"Tags"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/96670d01-0a4d-4649-9c89-2d3abc0a5025","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Enforces existence of a tag on resource groups.","type":["Microsoft.Resources/resourceGroups"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"tags['project']","exists":true}}},{
// Synopsis: To ensure secure configurations of in-guest settings of your machine, install the Guest Configuration extension. In-guest settings that the extension monitors include the configuration of the operating system, application configuration or presence, and environment settings. Once installed, in-guest policies will be available such as 'Windows Exploit guard should be enabled'. Learn more at https://aka.ms/gcpol.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.5b6dfb68a5e4","displayName":"Guest Configuration extension should be installed on your machines","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/ae89ebca-1c92-4898-ac2c-9f63decb045c","Azure.Policy/version":"1.0.3"}},"spec":{"recommend":"To ensure secure configurations of in-guest settings of your machine, install the Guest Configuration extension. In-guest settings that the extension monitors include the configuration of the operating system, application configuration or presence, and environment settings. Once installed, in-guest policies will be available such as 'Windows Exploit guard should be enabled'. Learn more at https://aka.ms/gcpol.","type":["Microsoft.Compute/virtualMachines"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"field":"properties.storageProfile.imageReference.publisher","in":["esri","incredibuild","MicrosoftDynamicsAX","MicrosoftSharepoint","MicrosoftVisualStudio","MicrosoftWindowsDesktop","MicrosoftWindowsServerHPCPack","microsoft-aks","qubole-inc","datastax","couchbase","scalegrid","checkpoint","paloaltonetworks","debian","credativ"]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftWindowsServer"},{"field":"properties.storageProfile.imageReference.sku","notLike":"2008*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftSQLServer"},{"field":"properties.storageProfile.imageReference.offer","notLike":"SQL2008*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"microsoft-dsvm"},{"field":"properties.storageProfile.imageReference.offer","equals":"dsvm-windows"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"microsoft-ads"},{"field":"properties.storageProfile.imageReference.offer","in":["standard-data-science-vm","windows-data-science-vm"]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"batch"},{"field":"properties.storageProfile.imageReference.offer","equals":"rendering-windows2016"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"center-for-internet-security-inc"},{"field":"properties.storageProfile.imageReference.offer","like":"cis-windows-server-201*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"pivotal"},{"field":"properties.storageProfile.imageReference.offer","like":"bosh-windows-server*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"cloud-infrastructure-services"},{"field":"properties.storageProfile.imageReference.offer","like":"ad*"}]},{"allOf":[{"anyOf":[{"field":"properties.osProfile.windowsConfiguration","exists":true},{"field":"properties.storageProfile.osDisk.osType","like":"Windows*"}]},{"anyOf":[{"field":"properties.storageProfile.imageReference.sku","exists":false},{"allOf":[{"field":"properties.storageProfile.imageReference.sku","notLike":"2008*"},{"field":"properties.storageProfile.imageReference.offer","notLike":"SQL2008*"}]}]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"OpenLogic"},{"field":"properties.storageProfile.imageReference.sku","notLike":"6*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Oracle"},{"field":"properties.storageProfile.imageReference.sku","notLike":"6*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"RedHat"},{"field":"properties.storageProfile.imageReference.sku","notLike":"6*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"center-for-internet-security-inc"},{"field":"properties.storageProfile.imageReference.offer","notLike":"cis-windows*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Suse"},{"field":"properties.storageProfile.imageReference.sku","notLike":"11*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.storageProfile.imageReference.sku","notLike":"12*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"microsoft-dsvm"},{"field":"properties.storageProfile.imageReference.offer","notLike":"dsvm-win*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"cloudera"},{"field":"properties.storageProfile.imageReference.sku","notLike":"6*"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"microsoft-ads"},{"field":"properties.storageProfile.imageReference.offer","like":"linux*"}]},{"allOf":[{"anyOf":[{"field":"properties.osProfile.linuxConfiguration","exists":true},{"field":"properties.storageProfile.osDisk.osType","like":"Linux*"}]},{"anyOf":[{"field":"properties.storageProfile.imageReference.publisher","exists":false},{"field":"properties.storageProfile.imageReference.publisher","notIn":["OpenLogic","RedHat","credativ","Suse","Canonical","microsoft-dsvm","cloudera","microsoft-ads","center-for-internet-security-inc","Oracle","AzureDatabricks","azureopenshift"]}]}]}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.publisher","equals":"Microsoft.GuestConfiguration"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachines/extensions"}}}},{
// Synopsis: The Guest Configuration extension requires a system assigned managed identity. Azure virtual machines in the scope of this policy will be non-compliant when they have the Guest Configuration extension installed but do not have a system assigned managed identity. Learn more at https://aka.ms/gcpol
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.eba3fd518936","displayName":"Virtual machines' Guest Configuration extension should be deployed with system-assigned managed identity","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/d26f7642-7545-4e18-9b75-8c9bbdee3a9a","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"The Guest Configuration extension requires a system assigned managed identity. Azure virtual machines in the scope of this policy will be non-compliant when they have the Guest Configuration extension installed but do not have a system assigned managed identity. Learn more at https://aka.ms/gcpol","type":["Microsoft.Compute/virtualMachines/extensions"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"properties.publisher","equals":"Microsoft.GuestConfiguration"},"condition":{"field":"resources","allOf":[{"field":"identity.type","contains":"SystemAssigned"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Compute/virtualMachines"},{"name":".","equals":"[first(split(field('fullName'), '/'))]"}]}}}},{
// Synopsis: Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.cb60567293c9","displayName":"Resource logs in IoT Hub should be enabled","tags":{"Azure.Policy/category":"Internet of Things"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/383856f8-de7f-44a2-81fc-e5135b5c2aa4","Azure.Policy/version":"3.1.0"}},"spec":{"recommend":"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised","type":["Microsoft.Devices/IotHubs"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"not":{"field":"retentionPolicy.enabled","equals":"true"}},{"field":"enabled","equals":"true"}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Network access to storage accounts should be restricted. Configure network rules so only applications from allowed networks can access the storage account. To allow connections from specific internet or on-premises clients, access can be granted to traffic from specific Azure virtual networks or to public internet IP address ranges
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.ff989b7c6a22","displayName":"Storage accounts should restrict network access","tags":{"Azure.Policy/category":"Storage"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/34c877ad-507e-4c82-993e-3452a6e0ad3c","Azure.Policy/version":"1.1.1"}},"spec":{"recommend":"Network access to storage accounts should be restricted. Configure network rules so only applications from allowed networks can access the storage account. To allow connections from specific internet or on-premises clients, access can be granted to traffic from specific Azure virtual networks or to public internet IP address ranges","type":["Microsoft.Storage/storageAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.networkAcls.defaultAction","equals":"Deny"}}},{
// Synopsis: Audit built-in roles such as 'Owner, Contributer, Reader' instead of custom RBAC roles, which are error prone. Using custom roles is treated as an exception and requires a rigorous review and threat modeling
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.c5cfcfd86322","displayName":"Audit usage of custom RBAC roles","tags":{"Azure.Policy/category":"General"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/a451c1ef-c6ca-483d-87ed-f49761e3ffb5","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"Audit built-in roles such as 'Owner, Contributer, Reader' instead of custom RBAC roles, which are error prone. Using custom roles is treated as an exception and requires a rigorous review and threat modeling","type":["Microsoft.Authorization/roleDefinitions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"properties.type","notEquals":"CustomRole"}}},{
// Synopsis: Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.2289f9ccdf2b","displayName":"Resource logs in Azure Stream Analytics should be enabled","tags":{"Azure.Policy/category":"Stream Analytics"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/f9be5368-9bf5-4b84-9e0a-7850da98bb46","Azure.Policy/version":"5.0.0"}},"spec":{"recommend":"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised","type":["Microsoft.StreamAnalytics/streamingJobs"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Audit requirement of Secure transfer in your storage account. Secure transfer is an option that forces your storage account to accept requests only from secure connections (HTTPS). Use of HTTPS ensures authentication between the server and the service and protects data in transit from network layer attacks such as man-in-the-middle, eavesdropping, and session-hijacking
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.7c4d59a4a424","displayName":"Secure transfer to storage accounts should be enabled","tags":{"Azure.Policy/category":"Storage"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/404c3081-a854-4457-ae30-26a93ef643f9","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Audit requirement of Secure transfer in your storage account. Secure transfer is an option that forces your storage account to accept requests only from secure connections (HTTPS). Use of HTTPS ensures authentication between the server and the service and protects data in transit from network layer attacks such as man-in-the-middle, eavesdropping, and session-hijacking","type":["Microsoft.Storage/storageAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"allOf":[{"field":"apiVersion","apiVersion":"<2019-04-01"},{"field":"properties.supportsHttpsTrafficOnly","exists":false}]},{"field":"properties.supportsHttpsTrafficOnly","equals":"false"}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8edab7bf4950","displayName":"Resource logs in Service Bus should be enabled","tags":{"Azure.Policy/category":"Service Bus"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/f8d36e2f-389b-4ee4-898d-21aeb69a0f45","Azure.Policy/version":"5.0.0"}},"spec":{"recommend":"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised","type":["Microsoft.ServiceBus/namespaces"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Service Fabric provides three levels of protection (None, Sign and EncryptAndSign) for node-to-node communication using a primary cluster certificate. Set the protection level to ensure that all node-to-node messages are encrypted and digitally signed
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8fc1f05dbb52","displayName":"Service Fabric clusters should have the ClusterProtectionLevel property set to EncryptAndSign","tags":{"Azure.Policy/category":"Service Fabric"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/617c02be-7f02-4efd-8836-3180d47b6c68","Azure.Policy/version":"1.1.0"}},"spec":{"recommend":"Service Fabric provides three levels of protection (None, Sign and EncryptAndSign) for node-to-node communication using a primary cluster certificate. Set the protection level to ensure that all node-to-node messages are encrypted and digitally signed","type":["Microsoft.ServiceFabric/clusters"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"field":"properties.fabricSettings[*].name","notEquals":"Security"},{"field":"properties.fabricSettings[*].parameters[*].name","notEquals":"ClusterProtectionLevel"},{"field":"properties.fabricSettings[*].parameters[*].value","notEquals":"EncryptAndSign"}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.57a6e2bf29a5","displayName":"Resource logs in Search services should be enabled","tags":{"Azure.Policy/category":"Search"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/b4330a05-a843-4bc8-bf9a-cacce50c67f4","Azure.Policy/version":"5.0.0"}},"spec":{"recommend":"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised","type":["Microsoft.Search/searchServices"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8bd74cbaec04","displayName":"Resource logs in Logic Apps should be enabled","tags":{"Azure.Policy/category":"Logic Apps"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/34f95f76-5386-4de7-b824-0d8478470c9d","Azure.Policy/version":"5.1.0"}},"spec":{"recommend":"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised","type":["Microsoft.Logic/workflows"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes when a security incident occurs or when your network is compromised
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.3b93d6157129","displayName":"Resource logs in Key Vault should be enabled","tags":{"Azure.Policy/category":"Key Vault"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/cf820ca0-f99e-4f3e-84fb-66e913812d21","Azure.Policy/version":"5.0.0"}},"spec":{"recommend":"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes when a security incident occurs or when your network is compromised","type":["Microsoft.KeyVault/vaults"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.2dc2fd21f5ed","displayName":"Resource logs in Event Hub should be enabled","tags":{"Azure.Policy/category":"Event Hub"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/83a214f7-d01a-484b-91a9-ed54470c9a6a","Azure.Policy/version":"5.0.0"}},"spec":{"recommend":"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised","type":["Microsoft.EventHub/namespaces"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.3901e2cca406","displayName":"Resource logs in Azure Data Lake Store should be enabled","tags":{"Azure.Policy/category":"Data Lake"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/057ef27e-665e-4328-8ea3-04b3122bd9fb","Azure.Policy/version":"5.0.0"}},"spec":{"recommend":"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised","type":["Microsoft.DataLakeStore/accounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.831fbfb17443","displayName":"Resource logs in Data Lake Analytics should be enabled","tags":{"Azure.Policy/category":"Data Lake"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/c95c74d9-38fe-4f0d-af86-0c7d626a315c","Azure.Policy/version":"5.0.0"}},"spec":{"recommend":"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised","type":["Microsoft.DataLakeAnalytics/accounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Use new Azure Resource Manager for your storage accounts to provide security enhancements such as: stronger access control (RBAC), better auditing, Azure Resource Manager based deployment and governance, access to managed identities, access to key vault for secrets, Azure AD-based authentication and support for tags and resource groups for easier security management
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.743564fcb70d","displayName":"Storage accounts should be migrated to new Azure Resource Manager resources","tags":{"Azure.Policy/category":"Storage"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/37e0d2fe-28a5-43d6-a273-67d37d1f5606","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Use new Azure Resource Manager for your storage accounts to provide security enhancements such as: stronger access control (RBAC), better auditing, Azure Resource Manager based deployment and governance, access to managed identities, access to key vault for secrets, Azure AD-based authentication and support for tags and resource groups for easier security management","type":["Microsoft.ClassicStorage/storageAccounts","Microsoft.Storage/StorageAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"where":{"allOf":[{"in":["Microsoft.ClassicStorage/storageAccounts","Microsoft.Storage/StorageAccounts"],"type":"."},{"equals":"Microsoft.ClassicStorage/storageAccounts","type":"."}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Use new Azure Resource Manager for your virtual machines to provide security enhancements such as: stronger access control (RBAC), better auditing, Azure Resource Manager based deployment and governance, access to managed identities, access to key vault for secrets, Azure AD-based authentication and support for tags and resource groups for easier security management
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.1c295edc6f47","displayName":"Virtual machines should be migrated to new Azure Resource Manager resources","tags":{"Azure.Policy/category":"Compute"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1d84d5fb-01f6-4d12-ba4f-4a26081d403d","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Use new Azure Resource Manager for your virtual machines to provide security enhancements such as: stronger access control (RBAC), better auditing, Azure Resource Manager based deployment and governance, access to managed identities, access to key vault for secrets, Azure AD-based authentication and support for tags and resource groups for easier security management","type":["Microsoft.ClassicCompute/virtualMachines","Microsoft.Compute/virtualMachines"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"where":{"allOf":[{"in":["Microsoft.ClassicCompute/virtualMachines","Microsoft.Compute/virtualMachines"],"type":"."},{"equals":"Microsoft.ClassicCompute/virtualMachines","type":"."}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.5514f29137a0","displayName":"Resource logs in Batch accounts should be enabled","tags":{"Azure.Policy/category":"Batch"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/428256e6-1fac-4f48-a757-df34c2b3336d","Azure.Policy/version":"5.0.0"}},"spec":{"recommend":"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised","type":["Microsoft.Batch/batchAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Transparent data encryption should be enabled to protect data-at-rest and meet compliance requirements
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.1d1a268fcf1b","displayName":"Transparent Data Encryption on SQL databases should be enabled","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/17k78e20-9358-41c9-923c-fb736d382a12","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Transparent data encryption should be enabled to protect data-at-rest and meet compliance requirements","type":["Microsoft.Sql/servers/databases"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"name","notEquals":"master"},"condition":{"field":"resources","allOf":[{"anyOf":[{"field":"properties.status","equals":"enabled"},{"field":"properties.state","equals":"enabled"}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/servers/databases/transparentDataEncryption"},{"name":".","equals":"current"}]}}}},{
// Synopsis: Auditing on your SQL Server should be enabled to track database activities across all databases on the server and save them in an audit log.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.5907b1677f79","displayName":"Auditing on SQL server should be enabled","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Auditing on your SQL Server should be enabled to track database activities across all databases on the server and save them in an audit log.","type":["Microsoft.Sql/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"kind","notContains":"analytics"},"condition":{"field":"resources","allOf":[{"field":"properties.state","equals":"enabled"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/servers/auditingSettings"},{"name":".","equals":"default"}]}}}},{
// Synopsis: Remote debugging requires inbound ports to be opened on Function apps. Remote debugging should be turned off.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.34b7c620d18e","displayName":"Function apps should have remote debugging turned off","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0e60b895-3786-45da-8377-9c6b4b6ac5f9","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Remote debugging requires inbound ports to be opened on Function apps. Remote debugging should be turned off.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"}]},"condition":{"field":"resources","allOf":[{"field":"properties.remoteDebuggingEnabled","equals":"false"}],"where":{"type":".","equals":"Microsoft.Web/sites/config"}}}},{
// Synopsis: Remote debugging requires inbound ports to be opened on an App Service app. Remote debugging should be turned off.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.08dc1a9ad2e5","displayName":"App Service apps should have remote debugging turned off","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/cb510bfd-1cba-4d9f-a230-cb0976f4bb71","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Remote debugging requires inbound ports to be opened on an App Service app. Remote debugging should be turned off.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"kind","notContains":"functionapp"},"condition":{"field":"resources","allOf":[{"field":"properties.remoteDebuggingEnabled","equals":"false"}],"where":{"type":".","equals":"Microsoft.Web/sites/config"}}}},{
// Synopsis: Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.ae6cf1e20ea3","displayName":"Function apps should only be accessible over HTTPS","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/6d555dd1-86f2-4f1c-8ed7-5abae7c6cbab","Azure.Policy/version":"5.0.0"}},"spec":{"recommend":"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"},{"anyOf":[{"field":"properties.httpsOnly","exists":false},{"field":"properties.httpsOnly","equals":"false"}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.49b05192a1aa","displayName":"App Service apps should only be accessible over HTTPS","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/a4af4a39-4135-47fb-b175-47fbdf85311d","Azure.Policy/version":"4.0.0"}},"spec":{"recommend":"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"kind","notContains":"functionapp"},{"anyOf":[{"field":"properties.httpsOnly","exists":false},{"field":"properties.httpsOnly","equals":"false"}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Cross-Origin Resource Sharing (CORS) should not allow all domains to access your Function app. Allow only required domains to interact with your Function app.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.a1096c3c65c2","displayName":"Function apps should not have CORS configured to allow every resource to access your apps","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0820b7b9-23aa-4725-a1ce-ae4558f718e5","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Cross-Origin Resource Sharing (CORS) should not allow all domains to access your Function app. Allow only required domains to interact with your Function app.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"}]},"condition":{"field":"resources","allOf":[{"field":"properties.cors.allowedOrigins[*]","notEquals":"*"}],"where":{"type":".","equals":"Microsoft.Web/sites/config"}}}},{
// Synopsis: Cross-Origin Resource Sharing (CORS) should not allow all domains to access your app. Allow only required domains to interact with your app.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.7fb6abe02d3c","displayName":"App Service apps should not have CORS configured to allow every resource to access your apps","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/5744710e-cc2f-4ee8-8809-3b11e89f4bc9","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Cross-Origin Resource Sharing (CORS) should not allow all domains to access your app. Allow only required domains to interact with your app.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"kind","notContains":"functionapp"},"condition":{"field":"resources","allOf":[{"field":"properties.cors.allowedOrigins[*]","notEquals":"*"}],"where":{"type":".","equals":"Microsoft.Web/sites/config"}}}},{
// Synopsis: Audit SQL servers without Advanced Data Security
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8a35c8a5ea23","displayName":"Azure Defender for SQL should be enabled for unprotected Azure SQL servers","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/abfb4388-5bf4-4ad7-ba82-2cd2f41ceae9","Azure.Policy/version":"2.0.1"}},"spec":{"recommend":"Audit SQL servers without Advanced Data Security","type":["Microsoft.Sql/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"kind","notContains":"analytics"},"condition":{"field":"resources","allOf":[{"field":"properties.state","equals":"Enabled"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/servers/securityAlertPolicies"},{"name":".","equals":"Default"}]}}}},{
// Synopsis: Microsoft Defender for APIs brings new discovery, protection, detection, & response coverage to monitor for common API based attacks & security misconfigurations.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.b864460a658b","displayName":"Microsoft Defender for APIs should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7926a6d1-b268-4586-8197-e8ae90c877d7","Azure.Policy/version":"1.0.3"}},"spec":{"recommend":"Microsoft Defender for APIs brings new discovery, protection, detection, & response coverage to monitor for common API based attacks & security misconfigurations.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"Api"}]}}}},{
// Synopsis: Audit each SQL Managed Instance without advanced data security.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.d4f23760f0d2","displayName":"Azure Defender for SQL should be enabled for unprotected SQL Managed Instances","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/abfb7388-5bf4-4ad7-ba99-2cd2f41cebb9","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Audit each SQL Managed Instance without advanced data security.","type":["Microsoft.Sql/managedInstances"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"field":"properties.state","equals":"Enabled"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/managedInstances/securityAlertPolicies"},{"name":".","equals":"Default"}]}}}},{
// Synopsis: Restrict access to the Kubernetes Service Management API by granting API access only to IP addresses in specific ranges. It is recommended to limit access to authorized IP ranges to ensure that only applications from allowed networks can access the cluster.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.5aff26738536","displayName":"Authorized IP ranges should be defined on Kubernetes Services","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0e246bcf-5f6f-4f87-bc6f-775d4712c7ea","Azure.Policy/version":"2.0.1"}},"spec":{"recommend":"Restrict access to the Kubernetes Service Management API by granting API access only to IP addresses in specific ranges. It is recommended to limit access to authorized IP ranges to ensure that only applications from allowed networks can access the cluster.","type":["Microsoft.ContainerService/managedClusters"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"where":{"allOf":[{"field":"properties.apiServerAccessProfile.authorizedIPRanges","exists":false},{"anyOf":[{"field":"properties.apiServerAccessProfile.enablePrivateCluster","exists":false},{"field":"properties.apiServerAccessProfile.enablePrivateCluster","equals":"false"}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Audit each SQL Managed Instance which doesn't have recurring vulnerability assessment scans enabled. Vulnerability assessment can discover, track, and help you remediate potential database vulnerabilities.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.f41e03212199","displayName":"Vulnerability assessment should be enabled on SQL Managed Instance","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1b7aa243-30e4-4c9e-bca8-d0d3022b634a","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"Audit each SQL Managed Instance which doesn't have recurring vulnerability assessment scans enabled. Vulnerability assessment can discover, track, and help you remediate potential database vulnerabilities.","type":["Microsoft.Sql/managedInstances"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"field":"properties.recurringScans.isEnabled","equals":"True"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/managedInstances/vulnerabilityAssessments"},{"name":".","equals":"default"}]}}}},{
// Synopsis: Implementing Transparent Data Encryption (TDE) with your own key provides increased transparency and control over the TDE Protector, increased security with an HSM-backed external service, and promotion of separation of duties. This recommendation applies to organizations with a related compliance requirement.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.4f1121ca318a","displayName":"SQL servers should use customer-managed keys to encrypt data at rest","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0a370ff3-6cab-4e85-8995-295fd854c5b8","Azure.Policy/version":"2.0.1"}},"spec":{"recommend":"Implementing Transparent Data Encryption (TDE) with your own key provides increased transparency and control over the TDE Protector, increased security with an HSM-backed external service, and promotion of separation of duties. This recommendation applies to organizations with a related compliance requirement.","type":["Microsoft.Sql/servers","Microsoft.Sql/servers/encryptionProtector"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"where":{"anyOf":[{"allOf":[{"equals":"Microsoft.Sql/servers","type":"."},{"value":"eastus","notContains":"/providers/Microsoft.Synapse/"},{"anyOf":[{"field":"properties.keyId","exists":false},{"field":"properties.keyId","equals":""}]}]},{"allOf":[{"equals":"Microsoft.Sql/servers/encryptionProtector","type":"."},{"value":"eastus","notContains":"/providers/Microsoft.Synapse/"},{"field":"properties.serverKeyType","notEquals":"AzureKeyVault"}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Implementing Transparent Data Encryption (TDE) with your own key provides you with increased transparency and control over the TDE Protector, increased security with an HSM-backed external service, and promotion of separation of duties. This recommendation applies to organizations with a related compliance requirement.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.013bcdae7b51","displayName":"SQL managed instances should use customer-managed keys to encrypt data at rest","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/ac01ad65-10e5-46df-bdd9-6b0cad13e1d2","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Implementing Transparent Data Encryption (TDE) with your own key provides you with increased transparency and control over the TDE Protector, increased security with an HSM-backed external service, and promotion of separation of duties. This recommendation applies to organizations with a related compliance requirement.","type":["Microsoft.Sql/managedInstances","Microsoft.Sql/managedInstances/encryptionProtector"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"where":{"anyOf":[{"allOf":[{"equals":"Microsoft.Sql/managedInstances","type":"."},{"anyOf":[{"field":"properties.keyId","exists":false},{"field":"properties.keyId","equals":""}]}]},{"allOf":[{"equals":"Microsoft.Sql/managedInstances/encryptionProtector","type":"."},{"field":"properties.serverKeyType","notEquals":"AzureKeyVault"}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Security Center uses the Microsoft Dependency agent to collect network traffic data from your Azure virtual machines to enable advanced network protection features such as traffic visualization on the network map, network hardening recommendations and specific network threats.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.0bd9037ec7b0","displayName":"[Preview]: Network traffic data collection agent should be installed on Windows virtual machines","tags":{"Azure.Policy/category":"Monitoring"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/2f2ee1de-44aa-4762-b6bd-0893fc3f306d","Azure.Policy/version":"1.0.2-preview"}},"spec":{"recommend":"Security Center uses the Microsoft Dependency agent to collect network traffic data from your Azure virtual machines to enable advanced network protection features such as traffic visualization on the network map, network hardening recommendations and specific network threats.","type":["Microsoft.Compute/virtualMachines"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftWindowsServer"},{"field":"properties.storageProfile.imageReference.offer","equals":"WindowsServer"},{"field":"properties.storageProfile.imageReference.sku","in":["2008-R2-SP1","2008-R2-SP1-smalldisk","2012-Datacenter","2012-Datacenter-smalldisk","2012-R2-Datacenter","2012-R2-Datacenter-smalldisk","2016-Datacenter","2016-Datacenter-Server-Core","2016-Datacenter-Server-Core-smalldisk","2016-Datacenter-smalldisk","2016-Datacenter-with-Containers","2016-Datacenter-with-RDSH","2019-Datacenter","2019-Datacenter-Core","2019-Datacenter-Core-smalldisk","2019-Datacenter-Core-with-Containers","2019-Datacenter-Core-with-Containers-smalldisk","2019-Datacenter-smalldisk","2019-Datacenter-with-Containers","2019-Datacenter-with-Containers-smalldisk","2019-Datacenter-zhcn"]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftWindowsServer"},{"field":"properties.storageProfile.imageReference.offer","equals":"WindowsServerSemiAnnual"},{"field":"properties.storageProfile.imageReference.sku","in":["Datacenter-Core-1709-smalldisk","Datacenter-Core-1709-with-Containers-smalldisk","Datacenter-Core-1803-with-Containers-smalldisk"]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftWindowsServerHPCPack"},{"field":"properties.storageProfile.imageReference.offer","equals":"WindowsServerHPCPack"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftSQLServer"},{"anyOf":[{"field":"properties.storageProfile.imageReference.offer","like":"*-WS2016"},{"field":"properties.storageProfile.imageReference.offer","like":"*-WS2016-BYOL"},{"field":"properties.storageProfile.imageReference.offer","like":"*-WS2012R2"},{"field":"properties.storageProfile.imageReference.offer","like":"*-WS2012R2-BYOL"}]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftRServer"},{"field":"properties.storageProfile.imageReference.offer","equals":"MLServer-WS2016"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftVisualStudio"},{"field":"properties.storageProfile.imageReference.offer","in":["VisualStudio","Windows"]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftDynamicsAX"},{"field":"properties.storageProfile.imageReference.offer","equals":"Dynamics"},{"field":"properties.storageProfile.imageReference.sku","equals":"Pre-Req-AX7-Onebox-U8"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"microsoft-ads"},{"field":"properties.storageProfile.imageReference.offer","equals":"windows-data-science-vm"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"MicrosoftWindowsDesktop"},{"field":"properties.storageProfile.imageReference.offer","equals":"Windows-10"}]}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.type","equals":"DependencyAgentWindows"},{"field":"properties.publisher","equals":"Microsoft.Azure.Monitoring.DependencyAgent"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachines/extensions"}}}},{
// Synopsis: Security Center uses the Microsoft Dependency agent to collect network traffic data from your Azure virtual machines to enable advanced network protection features such as traffic visualization on the network map, network hardening recommendations and specific network threats.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.4e24c971a1ac","displayName":"[Preview]: Network traffic data collection agent should be installed on Linux virtual machines","tags":{"Azure.Policy/category":"Monitoring"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/04c4380f-3fae-46e8-96c9-30193528f602","Azure.Policy/version":"1.0.2-preview"}},"spec":{"recommend":"Security Center uses the Microsoft Dependency agent to collect network traffic data from your Azure virtual machines to enable advanced network protection features such as traffic visualization on the network map, network hardening recommendations and specific network threats.","type":["Microsoft.Compute/virtualMachines"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.storageProfile.imageReference.offer","equals":"UbuntuServer"},{"anyOf":[{"field":"properties.storageProfile.imageReference.sku","in":["18.04-LTS","16.04-LTS","16.04.0-LTS","14.04.0-LTS","14.04.1-LTS","14.04.5-LTS"]}]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"RedHat"},{"field":"properties.storageProfile.imageReference.offer","in":["RHEL","RHEL-SAP-HANA"]},{"anyOf":[{"field":"properties.storageProfile.imageReference.sku","like":"6.*"},{"field":"properties.storageProfile.imageReference.sku","like":"7*"}]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"SUSE"},{"field":"properties.storageProfile.imageReference.offer","in":["SLES","SLES-HPC","SLES-HPC-Priority","SLES-SAP","SLES-SAP-BYOS","SLES-Priority","SLES-BYOS","SLES-SAPCAL","SLES-Standard"]},{"field":"properties.storageProfile.imageReference.sku","in":["12-SP2","12-SP3","12-SP4"]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"OpenLogic"},{"field":"properties.storageProfile.imageReference.offer","in":["CentOS","Centos-LVM","CentOS-SRIOV"]},{"anyOf":[{"field":"properties.storageProfile.imageReference.sku","like":"6.*"},{"field":"properties.storageProfile.imageReference.sku","like":"7*"}]}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"cloudera"},{"field":"properties.storageProfile.imageReference.offer","equals":"cloudera-centos-os"},{"field":"properties.storageProfile.imageReference.sku","like":"7*"}]}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.type","equals":"DependencyAgentLinux"},{"field":"properties.publisher","equals":"Microsoft.Azure.Monitoring.DependencyAgent"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachines/extensions"}}}},{
// Synopsis: This policy audits Windows Azure Arc machines if the Log Analytics extension is not installed.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.4fcb767b65c1","displayName":"[Preview]: Log Analytics extension should be installed on your Windows Azure Arc machines","tags":{"Azure.Policy/category":"Monitoring"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/d69b1763-b96d-40b8-a2d9-ca31e9fd0d3e","Azure.Policy/version":"1.0.1-preview"}},"spec":{"recommend":"This policy audits Windows Azure Arc machines if the Log Analytics extension is not installed.","type":["Microsoft.HybridCompute/machines"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"properties.osName","like":"windows*"},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.type","equals":"MicrosoftMonitoringAgent"},{"field":"properties.publisher","equals":"Microsoft.EnterpriseCloud.Monitoring"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.HybridCompute/machines/extensions"}}}},{
// Synopsis: This policy audits Linux Azure Arc machines if the Log Analytics extension is not installed.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.a278e6d48529","displayName":"[Preview]: Log Analytics extension should be installed on your Linux Azure Arc machines","tags":{"Azure.Policy/category":"Monitoring"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/842c54e8-c2f9-4d79-ae8d-38d8b8019373","Azure.Policy/version":"1.0.1-preview"}},"spec":{"recommend":"This policy audits Linux Azure Arc machines if the Log Analytics extension is not installed.","type":["Microsoft.HybridCompute/machines"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"properties.osName","like":"linux*"},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.type","equals":"OmsAgentForLinux"},{"field":"properties.publisher","equals":"Microsoft.EnterpriseCloud.Monitoring"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.HybridCompute/machines/extensions"}}}},{
// Synopsis: Azure Defender for Key Vault provides an additional layer of protection and security intelligence by detecting unusual and potentially harmful attempts to access or exploit key vault accounts.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.e043bfe9066e","displayName":"Azure Defender for Key Vault should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0e6763cc-5078-4e64-889d-ff4d9a839047","Azure.Policy/version":"1.0.3"}},"spec":{"recommend":"Azure Defender for Key Vault provides an additional layer of protection and security intelligence by detecting unusual and potentially harmful attempts to access or exploit key vault accounts.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"KeyVaults"}]}}}},{
// Synopsis: Azure Defender for SQL provides functionality for surfacing and mitigating potential database vulnerabilities, detecting anomalous activities that could indicate threats to SQL databases, and discovering and classifying sensitive data.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.496e2f7c1cda","displayName":"Azure Defender for Azure SQL Database servers should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7fe3b40f-802b-4cdd-8bd4-fd799c948cc2","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Azure Defender for SQL provides functionality for surfacing and mitigating potential database vulnerabilities, detecting anomalous activities that could indicate threats to SQL databases, and discovering and classifying sensitive data.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"SqlServers"}]}}}},{
// Synopsis: Azure Defender for SQL provides functionality for surfacing and mitigating potential database vulnerabilities, detecting anomalous activities that could indicate threats to SQL databases, and discovering and classifying sensitive data.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.526840153ee5","displayName":"Azure Defender for SQL servers on machines should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/6581d072-105e-4418-827f-bd446d56421b","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Azure Defender for SQL provides functionality for surfacing and mitigating potential database vulnerabilities, detecting anomalous activities that could indicate threats to SQL databases, and discovering and classifying sensitive data.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"SqlServerVirtualMachines"}]}}}},{
// Synopsis: Microsoft Defender for Storage (Classic) provides detections of unusual and potentially harmful attempts to access or exploit storage accounts.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.3a68b54c141f","displayName":"Microsoft Defender for Storage (Classic) should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/308fbb08-4ab8-4e67-9b29-592e93fb94fa","Azure.Policy/version":"1.0.4"}},"spec":{"recommend":"Microsoft Defender for Storage (Classic) provides detections of unusual and potentially harmful attempts to access or exploit storage accounts.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"StorageAccounts"}]}}}},{
// Synopsis: Azure Defender for App Service leverages the scale of the cloud, and the visibility that Azure has as a cloud provider, to monitor for common web app attacks.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.3d6c99f9b4a8","displayName":"Azure Defender for App Service should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/2913021d-f2fd-4f3d-b958-22354e2bdbcb","Azure.Policy/version":"1.0.3"}},"spec":{"recommend":"Azure Defender for App Service leverages the scale of the cloud, and the visibility that Azure has as a cloud provider, to monitor for common web app attacks.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"AppServices"}]}}}},{
// Synopsis: Microsoft Defender for Containers provides hardening, vulnerability assessment and run-time protections for your Azure, hybrid, and multi-cloud Kubernetes environments.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8f0ecb40906b","displayName":"Microsoft Defender for Containers should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1c988dd6-ade4-430f-a608-2a3e5b0a6d38","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Microsoft Defender for Containers provides hardening, vulnerability assessment and run-time protections for your Azure, hybrid, and multi-cloud Kubernetes environments.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"Containers"}]}}}},{
// Synopsis: Azure Defender for servers provides real-time threat protection for server workloads and generates hardening recommendations as well as alerts about suspicious activities.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.4649ef3e8d2d","displayName":"Azure Defender for servers should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/4da35fc9-c9e7-4960-aec9-797fe7d9051d","Azure.Policy/version":"1.0.3"}},"spec":{"recommend":"Azure Defender for servers provides real-time threat protection for server workloads and generates hardening recommendations as well as alerts about suspicious activities.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"VirtualMachines"}]}}}},{
// Synopsis: The Azure Policy extension for Azure Arc provides at-scale enforcements and safeguards on your Arc enabled Kubernetes clusters in a centralized, consistent manner. Learn more at https://aka.ms/akspolicydoc.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.e39848110a3a","displayName":"Azure Arc enabled Kubernetes clusters should have the Azure Policy extension installed","tags":{"Azure.Policy/category":"Kubernetes"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/6b2122c1-8120-4ff5-801b-17625a355590","Azure.Policy/version":"1.1.0"}},"spec":{"recommend":"The Azure Policy extension for Azure Arc provides at-scale enforcements and safeguards on your Arc enabled Kubernetes clusters in a centralized, consistent manner. Learn more at https://aka.ms/akspolicydoc.","type":["Microsoft.Kubernetes/connectedClusters"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"properties.distribution","notEquals":"aks"},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.extensionType","equals":"microsoft.policyinsights"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.KubernetesConfiguration/extensions"}}}},{
// Synopsis: Microsoft Defender for Cloud extension for Azure Arc provides threat protection for your Arc enabled Kubernetes clusters. The extension collects data from all nodes in the cluster and sends it to the Azure Defender for Kubernetes backend in the cloud for further analysis. Learn more in https://docs.microsoft.com/azure/defender-for-cloud/defender-for-containers-enable?pivots=defender-for-container-arc.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.952417dfb4b9","displayName":"[Preview]: Azure Arc enabled Kubernetes clusters should have Microsoft Defender for Cloud extension installed","tags":{"Azure.Policy/category":"Kubernetes"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/8dfab9c4-fe7b-49ad-85e4-1e9be085358f","Azure.Policy/version":"6.0.0-preview"}},"spec":{"recommend":"Microsoft Defender for Cloud extension for Azure Arc provides threat protection for your Arc enabled Kubernetes clusters. The extension collects data from all nodes in the cluster and sends it to the Azure Defender for Kubernetes backend in the cloud for further analysis. Learn more in https://docs.microsoft.com/azure/defender-for-cloud/defender-for-containers-enable?pivots=defender-for-container-arc.","type":["Microsoft.Kubernetes/connectedClusters"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"properties.distribution","notIn":["aks","aks_management","eks","gke"]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.extensionType","equals":"microsoft.azuredefender.kubernetes"},{"field":"properties.provisioningState","equals":"Succeeded"}]}],"where":{"type":".","equals":"Microsoft.KubernetesConfiguration/extensions"}}}},{
// Synopsis: Microsoft Defender for Containers provides cloud-native Kubernetes security capabilities including environment hardening, workload protection, and run-time protection. When you enable the SecurityProfile.AzureDefender on your Azure Kubernetes Service cluster, an agent is deployed to your cluster to collect security event data. Learn more about Microsoft Defender for Containers in https://docs.microsoft.com/azure/defender-for-cloud/defender-for-containers-introduction?tabs=defender-for-container-arch-aks
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.56b22bf44513","displayName":"Azure Kubernetes Service clusters should have Defender profile enabled","tags":{"Azure.Policy/category":"Kubernetes"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/a1840de2-8088-4ea8-b153-b4c723e9cb01","Azure.Policy/version":"2.0.1"}},"spec":{"recommend":"Microsoft Defender for Containers provides cloud-native Kubernetes security capabilities including environment hardening, workload protection, and run-time protection. When you enable the SecurityProfile.AzureDefender on your Azure Kubernetes Service cluster, an agent is deployed to your cluster to collect security event data. Learn more about Microsoft Defender for Containers in https://docs.microsoft.com/azure/defender-for-cloud/defender-for-containers-introduction?tabs=defender-for-container-arch-aks","type":["Microsoft.ContainerService/managedClusters"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.securityProfile.defender.securityMonitoring.enabled","equals":true}}},{
// Synopsis: Use a managed identity for enhanced authentication security
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.bf7d368c94da","displayName":"Function apps should use managed identity","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0da106f2-4ca3-48e8-bc85-c638fe6aea8f","Azure.Policy/version":"3.0.0"}},"spec":{"recommend":"Use a managed identity for enhanced authentication security","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"}]},"condition":{"field":"resources","allOf":[{"anyOf":[{"field":"properties.managedServiceIdentityId","exists":true},{"field":"properties.xManagedServiceIdentityId","exists":true}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Azure Database for MariaDB allows you to choose the redundancy option for your database server. It can be set to a geo-redundant backup storage in which the data is not only stored within the region in which your server is hosted, but is also replicated to a paired region to provide recovery option in case of a region failure. Configuring geo-redundant storage for backup is only allowed during server create.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.3a421ee5e022","displayName":"Geo-redundant backup should be enabled for Azure Database for MariaDB","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0ec47710-77ff-4a3d-9181-6aa50af424d0","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"Azure Database for MariaDB allows you to choose the redundancy option for your database server. It can be set to a geo-redundant backup storage in which the data is not only stored within the region in which your server is hosted, but is also replicated to a paired region to provide recovery option in case of a region failure. Configuring geo-redundant storage for backup is only allowed during server create.","type":["Microsoft.DBforMariaDB/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.storageProfile.geoRedundantBackup","equals":"Enabled"}}},{
// Synopsis: Use a managed identity for enhanced authentication security
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.b036eb12aa85","displayName":"App Service apps should use managed identity","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/2b9ad585-36bc-4615-b300-fd4435808332","Azure.Policy/version":"3.0.0"}},"spec":{"recommend":"Use a managed identity for enhanced authentication security","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"kind","notContains":"functionapp"},"condition":{"field":"resources","allOf":[{"anyOf":[{"field":"properties.managedServiceIdentityId","exists":true},{"field":"properties.xManagedServiceIdentityId","exists":true}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Azure Database for PostgreSQL allows you to choose the redundancy option for your database server. It can be set to a geo-redundant backup storage in which the data is not only stored within the region in which your server is hosted, but is also replicated to a paired region to provide recovery option in case of a region failure. Configuring geo-redundant storage for backup is only allowed during server create.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.1abc8950449b","displayName":"Geo-redundant backup should be enabled for Azure Database for PostgreSQL","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/48af4db5-9b8b-401c-8e74-076be876a430","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"Azure Database for PostgreSQL allows you to choose the redundancy option for your database server. It can be set to a geo-redundant backup storage in which the data is not only stored within the region in which your server is hosted, but is also replicated to a paired region to provide recovery option in case of a region failure. Configuring geo-redundant storage for backup is only allowed during server create.","type":["Microsoft.DBforPostgreSQL/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.storageProfile.geoRedundantBackup","equals":"Enabled"}}},{
// Synopsis: Client certificates allow for the app to request a certificate for incoming requests. Only clients that have a valid certificate will be able to reach the app.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.a81332fdb7c6","displayName":"App Service apps should have 'Client Certificates (Incoming client certificates)' enabled","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/5bb220d9-2698-4ee4-8404-b9c30c9df609","Azure.Policy/version":"3.0.0"}},"spec":{"recommend":"Client certificates allow for the app to request a certificate for incoming requests. Only clients that have a valid certificate will be able to reach the app.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"kind","notContains":"functionapp"},{"anyOf":[{"field":"properties.clientCertEnabled","exists":false},{"field":"properties.clientCertEnabled","equals":"false"}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Azure Database for MySQL allows you to choose the redundancy option for your database server. It can be set to a geo-redundant backup storage in which the data is not only stored within the region in which your server is hosted, but is also replicated to a paired region to provide recovery option in case of a region failure. Configuring geo-redundant storage for backup is only allowed during server create.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.2747ab9b4fde","displayName":"Geo-redundant backup should be enabled for Azure Database for MySQL","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/82339799-d096-41ae-8538-b108becf0970","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"Azure Database for MySQL allows you to choose the redundancy option for your database server. It can be set to a geo-redundant backup storage in which the data is not only stored within the region in which your server is hosted, but is also replicated to a paired region to provide recovery option in case of a region failure. Configuring geo-redundant storage for backup is only allowed during server create.","type":["Microsoft.DBforMySQL/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.storageProfile.geoRedundantBackup","equals":"Enabled"}}},{
// Synopsis: Audit enabling of resource logs on the app. This enables you to recreate activity trails for investigation purposes if a security incident occurs or your network is compromised.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.6725eb4c81eb","displayName":"App Service apps should have resource logs enabled","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/91a78b24-f231-4a8a-8da9-02c35b2b6510","Azure.Policy/version":"2.0.1"}},"spec":{"recommend":"Audit enabling of resource logs on the app. This enables you to recreate activity trails for investigation purposes if a security incident occurs or your network is compromised.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"kind","notContains":"functionapp"},"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Periodically, newer versions are released for TLS either due to security flaws, include additional functionality, and enhance speed. Upgrade to the latest TLS version for App Service apps to take advantage of security fixes, if any, and/or new functionalities of the latest version.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.2f5a77cc8518","displayName":"App Service apps should use the latest TLS version","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/f0e6e85b-9b9f-4a4b-b67b-f730d42f1b0b","Azure.Policy/version":"2.0.1"}},"spec":{"recommend":"Periodically, newer versions are released for TLS either due to security flaws, include additional functionality, and enhance speed. Upgrade to the latest TLS version for App Service apps to take advantage of security fixes, if any, and/or new functionalities of the latest version.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"kind","notContains":"functionapp"},"condition":{"field":"resources","allOf":[{"field":"properties.minTlsVersion","equals":"1.2"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Periodically, newer versions are released for TLS either due to security flaws, include additional functionality, and enhance speed. Upgrade to the latest TLS version for Function apps to take advantage of security fixes, if any, and/or new functionalities of the latest version.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.ac0e0745ea85","displayName":"Function apps should use the latest TLS version","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/f9d614c5-c173-4d56-95a7-b4437057d193","Azure.Policy/version":"2.0.1"}},"spec":{"recommend":"Periodically, newer versions are released for TLS either due to security flaws, include additional functionality, and enhance speed. Upgrade to the latest TLS version for Function apps to take advantage of security fixes, if any, and/or new functionalities of the latest version.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"}]},"condition":{"field":"resources","allOf":[{"field":"properties.minTlsVersion","equals":"1.2"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for PostgreSQL. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.a01ecf8e605c","displayName":"Private endpoint should be enabled for PostgreSQL servers","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0564d078-92f5-4f97-8398-b9f58a51f70b","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for PostgreSQL. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.","type":["Microsoft.DBforPostgreSQL/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}],"where":{"type":".","equals":"Microsoft.DBforPostgreSQL/servers/privateEndpointConnections"}}}},{
// Synopsis: Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for MariaDB. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.9dba0a19beda","displayName":"Private endpoint should be enabled for MariaDB servers","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0a1302fb-a631-4106-9753-f3d494733990","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for MariaDB. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.","type":["Microsoft.DBforMariaDB/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}],"where":{"type":".","equals":"Microsoft.DBforMariaDB/servers/privateEndpointConnections"}}}},{
// Synopsis: Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for MySQL. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.c13ab0ca9371","displayName":"Private endpoint should be enabled for MySQL servers","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7595c971-233d-4bcf-bd18-596129188c49","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for MySQL. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.","type":["Microsoft.DBforMySQL/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}],"where":{"type":".","equals":"Microsoft.DBforMySQL/servers/privateEndpointConnections"}}}},{
// Synopsis: For incident investigation purposes, we recommend setting the data retention for your SQL Server' auditing to storage account destination to at least 90 days. Confirm that you are meeting the necessary retention rules for the regions in which you are operating. This is sometimes required for compliance with regulatory standards.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.2b8467e53847","displayName":"SQL servers with auditing to storage account destination should be configured with 90 days retention or higher","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/89099bee-89e0-4b26-a5f4-165451757743","Azure.Policy/version":"3.0.0"}},"spec":{"recommend":"For incident investigation purposes, we recommend setting the data retention for your SQL Server' auditing to storage account destination to at least 90 days. Confirm that you are meeting the necessary retention rules for the regions in which you are operating. This is sometimes required for compliance with regulatory standards.","type":["Microsoft.Sql/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"kind","notContains":"analytics"},"condition":{"field":"resources","allOf":[{"anyOf":[{"allOf":[{"field":"properties.isAzureMonitorTargetEnabled","equals":true},{"field":"properties.storageEndpoint","equals":""}]},{"field":"properties.retentionDays","equals":0},{"field":"properties.retentionDays","greaterOrEquals":90,"convert":true}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Sql/servers/auditingSettings"},{"name":".","equals":"default"}]}}}},{
// Synopsis: Enable FTPS enforcement for enhanced security.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.850233b97300","displayName":"Function apps should require FTPS only","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/399b2637-a50f-4f95-96f8-3a145476eb15","Azure.Policy/version":"3.0.0"}},"spec":{"recommend":"Enable FTPS enforcement for enhanced security.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"}]},"condition":{"field":"resources","allOf":[{"field":"properties.ftpsState","in":["FtpsOnly","Disabled"]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Enable FTPS enforcement for enhanced security.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.3f417ed39688","displayName":"App Service apps should require FTPS only","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/4d24b6d4-5e53-4a4f-a7f4-618fa573ee4b","Azure.Policy/version":"3.0.0"}},"spec":{"recommend":"Enable FTPS enforcement for enhanced security.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"kind","notContains":"functionapp"},"condition":{"field":"resources","allOf":[{"field":"properties.ftpsState","in":["FtpsOnly","Disabled"]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Web/sites/config"},{"name":".","equals":"web"}]}}}},{
// Synopsis: Client certificates allow for the app to request a certificate for incoming requests. Only clients with valid certificates will be able to reach the app.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.386b54ca5c79","displayName":"Function apps should have 'Client Certificates (Incoming client certificates)' enabled","tags":{"Azure.Policy/category":"App Service"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/eaebaea7-8013-4ceb-9d14-7eb32271373c","Azure.Policy/version":"3.0.0"}},"spec":{"recommend":"Client certificates allow for the app to request a certificate for incoming requests. Only clients with valid certificates will be able to reach the app.","type":["Microsoft.Web/sites"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"kind","contains":"functionapp"},{"field":"kind","notContains":"workflowapp"},{"anyOf":[{"field":"properties.clientCertEnabled","exists":false},{"field":"properties.clientCertEnabled","equals":"false"}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data stored in Cognitive Services to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more about customer-managed keys at https://go.microsoft.com/fwlink/?linkid=2121321.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.fd55be0f7a2d","displayName":"Cognitive Services accounts should enable data encryption with a customer-managed key","tags":{"Azure.Policy/category":"Cognitive Services"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/67121cc7-ff39-4ab8-b7e3-95b84dab487d","Azure.Policy/version":"2.1.0"}},"spec":{"recommend":"Customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data stored in Cognitive Services to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more about customer-managed keys at https://go.microsoft.com/fwlink/?linkid=2121321.","type":["Microsoft.CognitiveServices/accounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"properties.encryption.keySource","notEquals":"Microsoft.KeyVault"},{"field":"kind","notIn":["CognitiveServices","Knowledge","LUIS","QnAMaker","TextAnalytics","ComputerVision","HealthDecisionSupport","ImmersiveReader"]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Use customer-managed keys to manage the encryption at rest of your Azure Cosmos DB. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/cosmosdb-cmk.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.7daeb6c41b08","displayName":"Azure Cosmos DB accounts should use customer-managed keys to encrypt data at rest","tags":{"Azure.Policy/category":"Cosmos DB"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1f905d99-2ab7-462c-a6b0-f709acca6c8f","Azure.Policy/version":"1.1.0"}},"spec":{"recommend":"Use customer-managed keys to manage the encryption at rest of your Azure Cosmos DB. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/cosmosdb-cmk.","type":["Microsoft.DocumentDB/databaseAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.keyVaultKeyUri","exists":true}}},{
// Synopsis: Disabling local authentication methods improves security by ensuring that Cosmos DB database accounts exclusively require Azure Active Directory identities for authentication. Learn more at: https://docs.microsoft.com/azure/cosmos-db/how-to-setup-rbac#disable-local-auth.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.3d378b46ee47","displayName":"Cosmos DB database accounts should have local authentication methods disabled","tags":{"Azure.Policy/category":"Cosmos DB"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/5450f5bd-9c72-4390-a9c4-a7aba4edfdd2","Azure.Policy/version":"1.1.0"}},"spec":{"recommend":"Disabling local authentication methods improves security by ensuring that Cosmos DB database accounts exclusively require Azure Active Directory identities for authentication. Learn more at: https://docs.microsoft.com/azure/cosmos-db/how-to-setup-rbac#disable-local-auth.","type":["Microsoft.DocumentDB/databaseAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"properties.disableLocalAuth","notEquals":true},{"field":"properties.capabilities[*].name","notin":["EnableMongo","EnableCassandra","EnableTable","EnableGremlin"]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Deleting a key vault without soft delete enabled permanently deletes all secrets, keys, and certificates stored in the key vault. Accidental deletion of a key vault can lead to permanent data loss. Soft delete allows you to recover an accidentally deleted key vault for a configurable retention period.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8a375058ab5f","displayName":"Key vaults should have soft delete enabled","tags":{"Azure.Policy/category":"Key Vault"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d","Azure.Policy/version":"3.0.0"}},"spec":{"recommend":"Deleting a key vault without soft delete enabled permanently deletes all secrets, keys, and certificates stored in the key vault. Accidental deletion of a key vault can lead to permanent data loss. Soft delete allows you to recover an accidentally deleted key vault for a configurable retention period.","type":["Microsoft.KeyVault/vaults"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"not":{"field":"properties.createMode","equals":"recover"}},{"anyOf":[{"allOf":[{"field":"apiVersion","apiVersion":"<2019-09-01"},{"anyOf":[{"field":"properties.enableSoftDelete","equals":"false"},{"field":"properties.enableSoftDelete","exists":false}]}]},{"allOf":[{"field":"apiVersion","apiVersion":">=2019-09-01"},{"field":"properties.enableSoftDelete","equals":"false"}]}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Private endpoints lets you connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to your Azure Cache for Redis instances, data leakage risks are reduced. Learn more at: https://docs.microsoft.com/azure/azure-cache-for-redis/cache-private-link.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.a9b75f6198d9","displayName":"Azure Cache for Redis should use private link","tags":{"Azure.Policy/category":"Cache"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7803067c-7d34-46e3-8c79-0ca68fc4036d","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Private endpoints lets you connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to your Azure Cache for Redis instances, data leakage risks are reduced. Learn more at: https://docs.microsoft.com/azure/azure-cache-for-redis/cache-private-link.","type":["Microsoft.Cache/redis"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}],"where":{"type":".","equals":"Microsoft.Cache/redis/privateEndpointConnections"}}}},{
// Synopsis: Secure your blob and file storage account with greater flexibility using customer-managed keys. When you specify a customer-managed key, that key is used to protect and control access to the key that encrypts your data. Using customer-managed keys provides additional capabilities to control rotation of the key encryption key or cryptographically erase data.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.92737d530d6d","displayName":"Storage accounts should use customer-managed key for encryption","tags":{"Azure.Policy/category":"Storage"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/6fac406b-40ca-413b-bf8e-0bf964659c25","Azure.Policy/version":"1.0.3"}},"spec":{"recommend":"Secure your blob and file storage account with greater flexibility using customer-managed keys. When you specify a customer-managed key, that key is used to protect and control access to the key that encrypts your data. Using customer-managed keys provides additional capabilities to control rotation of the key encryption key or cryptographically erase data.","type":["Microsoft.Storage/storageAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"not":{"field":"properties.encryption.keySource","equals":"Microsoft.Keyvault"}}}},{
// Synopsis: Protect your storage accounts from potential threats using virtual network rules as a preferred method instead of IP-based filtering. Disabling IP-based filtering prevents public IPs from accessing your storage accounts.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.6ca692dbc7d9","displayName":"Storage accounts should restrict network access using virtual network rules","tags":{"Azure.Policy/category":"Storage"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/2a1a9cdf-e04d-429a-8416-3bfb72a1b26f","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"Protect your storage accounts from potential threats using virtual network rules as a preferred method instead of IP-based filtering. Disabling IP-based filtering prevents public IPs from accessing your storage accounts.","type":["Microsoft.Storage/storageAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"field":"properties.networkAcls.defaultAction","notEquals":"Deny"},{"greaterOrEquals":1,"field":"properties.networkAcls.ipRules[*]","convert":true}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Use customer-managed keys to manage the encryption at rest of the contents of your registries. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/acr/CMK.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.fb54a8938feb","displayName":"Container registries should be encrypted with a customer-managed key","tags":{"Azure.Policy/category":"Container Registry"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/5b9159ae-1701-4a6f-9a7a-aa9c8ddd0580","Azure.Policy/version":"1.1.2"}},"spec":{"recommend":"Use customer-managed keys to manage the encryption at rest of the contents of your registries. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/acr/CMK.","type":["Microsoft.ContainerRegistry/registries"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.encryption.status","equals":"enabled"}}},{
// Synopsis: Azure container registries by default accept connections over the internet from hosts on any network. To protect your registries from potential threats, allow access from only specific private endpoints, public IP addresses or address ranges. If your registry doesn't have network rules configured, it will appear in the unhealthy resources. Learn more about Container Registry network rules here: https://aka.ms/acr/privatelink, https://aka.ms/acr/portal/public-network and https://aka.ms/acr/vnet.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.4b9371c6f845","displayName":"Container registries should not allow unrestricted network access","tags":{"Azure.Policy/category":"Container Registry"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/d0793b48-0edc-4296-a390-4c75d1bdfd71","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Azure container registries by default accept connections over the internet from hosts on any network. To protect your registries from potential threats, allow access from only specific private endpoints, public IP addresses or address ranges. If your registry doesn't have network rules configured, it will appear in the unhealthy resources. Learn more about Container Registry network rules here: https://aka.ms/acr/privatelink, https://aka.ms/acr/portal/public-network and https://aka.ms/acr/vnet.","type":["Microsoft.ContainerRegistry/registries"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"anyof":[{"field":"properties.networkRuleSet.defaultAction","exists":false},{"field":"properties.networkRuleSet.defaultAction","equals":"Allow"}]},{"anyof":[{"field":"properties.publicNetworkAccess","exists":false},{"field":"properties.publicNetworkAccess","equals":"Enabled"}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The private link platform handles the connectivity between the consumer and services over the Azure backbone network.By mapping private endpoints to your container registries instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/acr/private-link.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.461d1f44b1aa","displayName":"Container registries should use private link","tags":{"Azure.Policy/category":"Container Registry"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/e8eef0a8-67cf-4eb4-9386-14b0e78733d4","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The private link platform handles the connectivity between the consumer and services over the Azure backbone network.By mapping private endpoints to your container registries instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/acr/private-link.","type":["Microsoft.ContainerRegistry/registries"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"less":1,"field":"properties.privateEndpointConnections[*]","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}]}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The private link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your app configuration instances instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/appconfig/private-endpoint.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.e42c83ddf556","displayName":"App Configuration should use private link","tags":{"Azure.Policy/category":"App Configuration"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/ca610c1d-041c-4332-9d88-7ed3094967c7","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The private link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your app configuration instances instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/appconfig/private-endpoint.","type":["Microsoft.AppConfiguration/configurationStores"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}],"where":{"type":".","equals":"Microsoft.AppConfiguration/configurationStores/privateEndpointConnections"}}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your Event Grid domain instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/privateendpoints.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.f0ed6ed4c579","displayName":"Azure Event Grid domains should use private link","tags":{"Azure.Policy/category":"Event Grid"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/9830b652-8523-49cc-b1b3-e17dce1127ca","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your Event Grid domain instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/privateendpoints.","type":["Microsoft.EventGrid/domains"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"less":1,"field":"properties.privateEndpointConnections[*]","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}]}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your Event Grid topic instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/privateendpoints.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.adcb60fcba2a","displayName":"Azure Event Grid topics should use private link","tags":{"Azure.Policy/category":"Event Grid"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/4b90e17e-8448-49db-875e-bd83fb6f804f","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your Event Grid topic instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/privateendpoints.","type":["Microsoft.EventGrid/topics"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"kind","notEquals":"AzureArc"},{"less":1,"field":"properties.privateEndpointConnections[*]","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The private link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your Azure SignalR Service resource instead of the entire service, you'll reduce your data leakage risks. Learn more about private links at: https://aka.ms/asrs/privatelink.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.23b5f50629ce","displayName":"Azure SignalR Service should use private link","tags":{"Azure.Policy/category":"SignalR"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/2393d2cf-a342-44cd-a2e2-fe0188fd1234","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The private link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your Azure SignalR Service resource instead of the entire service, you'll reduce your data leakage risks. Learn more about private links at: https://aka.ms/asrs/privatelink.","type":["Microsoft.SignalRService/SignalR"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"less":1,"field":"properties.privateEndpointConnections[*]","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}]}}},{
// Synopsis: Manage encryption at rest of Azure Machine Learning workspace data with customer-managed keys. By default, customer data is encrypted with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/azureml-workspaces-cmk.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8da4217e7110","displayName":"Azure Machine Learning workspaces should be encrypted with a customer-managed key","tags":{"Azure.Policy/category":"Machine Learning"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/ba769a63-b8cc-4b2d-abf6-ac33c7204be8","Azure.Policy/version":"1.0.3"}},"spec":{"recommend":"Manage encryption at rest of Azure Machine Learning workspace data with customer-managed keys. By default, customer data is encrypted with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/azureml-workspaces-cmk.","type":["Microsoft.MachineLearningServices/workspaces"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"not":{"field":"properties.encryption.status","equals":"enabled"}}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to Azure Machine Learning workspaces, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/machine-learning/how-to-configure-private-link.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.c9792e606f7d","displayName":"Azure Machine Learning workspaces should use private link","tags":{"Azure.Policy/category":"Machine Learning"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/45e05259-1eb5-4f70-9574-baf73e9d219b","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to Azure Machine Learning workspaces, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/machine-learning/how-to-configure-private-link.","type":["Microsoft.MachineLearningServices/workspaces"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"less":1,"field":"properties.privateEndpointConnections[*]","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}]}}},{
// Synopsis: Deploy Azure Web Application Firewall (WAF) in front of public facing web applications for additional inspection of incoming traffic. Web Application Firewall (WAF) provides centralized protection of your web applications from common exploits and vulnerabilities such as SQL injections, Cross-Site Scripting, local and remote file executions. You can also restrict access to your web applications by countries, IP address ranges, and other http(s) parameters via custom rules.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.348065eec5d9","displayName":"Azure Web Application Firewall should be enabled for Azure Front Door entry-points","tags":{"Azure.Policy/category":"Network"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/055aa869-bc98-4af8-bafc-23f1ab6ffe2c","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Deploy Azure Web Application Firewall (WAF) in front of public facing web applications for additional inspection of incoming traffic. Web Application Firewall (WAF) provides centralized protection of your web applications from common exploits and vulnerabilities such as SQL injections, Cross-Site Scripting, local and remote file executions. You can also restrict access to your web applications by countries, IP address ranges, and other http(s) parameters via custom rules.","type":["Microsoft.Network/frontdoors"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.frontendEndpoints[*].properties.webApplicationFirewallPolicyLink.id","exists":true}}},{
// Synopsis: Deploy Azure Web Application Firewall (WAF) in front of public facing web applications for additional inspection of incoming traffic. Web Application Firewall (WAF) provides centralized protection of your web applications from common exploits and vulnerabilities such as SQL injections, Cross-Site Scripting, local and remote file executions. You can also restrict access to your web applications by countries, IP address ranges, and other http(s) parameters via custom rules.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.22c2ff32bf65","displayName":"Web Application Firewall (WAF) should be enabled for Application Gateway","tags":{"Azure.Policy/category":"Network"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/564feb30-bf6a-4854-b4bb-0d2d2d1e6c66","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Deploy Azure Web Application Firewall (WAF) in front of public facing web applications for additional inspection of incoming traffic. Web Application Firewall (WAF) provides centralized protection of your web applications from common exploits and vulnerabilities such as SQL injections, Cross-Site Scripting, local and remote file executions. You can also restrict access to your web applications by countries, IP address ranges, and other http(s) parameters via custom rules.","type":["Microsoft.Network/applicationGateways"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"properties.webApplicationFirewallConfiguration","exists":false},{"field":"properties.firewallPolicy","exists":false}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Disable the public network access property to improve security and ensure your Azure Database for MariaDB can only be accessed from a private endpoint. This configuration strictly disables access from any public address space outside of Azure IP range, and denies all logins that match IP or virtual network-based firewall rules.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.9f931f3d80c2","displayName":"Public network access should be disabled for MariaDB servers","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/fdccbe47-f3e3-4213-ad5d-ea459b2fa077","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Disable the public network access property to improve security and ensure your Azure Database for MariaDB can only be accessed from a private endpoint. This configuration strictly disables access from any public address space outside of Azure IP range, and denies all logins that match IP or virtual network-based firewall rules.","type":["Microsoft.DBforMariaDB/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.publicNetworkAccess","equals":"Disabled"}}},{
// Synopsis: Disable the public network access property to improve security and ensure your Azure Database for MySQL can only be accessed from a private endpoint. This configuration strictly disables access from any public address space outside of Azure IP range, and denies all logins that match IP or virtual network-based firewall rules.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.994f4525bccf","displayName":"Public network access should be disabled for MySQL servers","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/d9844e8a-1437-4aeb-a32c-0c992f056095","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Disable the public network access property to improve security and ensure your Azure Database for MySQL can only be accessed from a private endpoint. This configuration strictly disables access from any public address space outside of Azure IP range, and denies all logins that match IP or virtual network-based firewall rules.","type":["Microsoft.DBforMySQL/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.publicNetworkAccess","equals":"Disabled"}}},{
// Synopsis: Use customer-managed keys to manage the encryption at rest of your MySQL servers. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.b09d39c9970f","displayName":"MySQL servers should use customer-managed keys to encrypt data at rest","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/83cef61d-dbd1-4b20-a4fc-5fbc7da10833","Azure.Policy/version":"1.0.4"}},"spec":{"recommend":"Use customer-managed keys to manage the encryption at rest of your MySQL servers. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management.","type":["Microsoft.DBforMySQL/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.serverKeyType","equals":"AzureKeyVault"},{"field":"properties.uri","notEquals":""},{"field":"properties.uri","exists":true}]}],"where":{"type":".","equals":"Microsoft.DBforMySQL/servers/keys"}}}},{
// Synopsis: Disable the public network access property to improve security and ensure your Azure Database for PostgreSQL can only be accessed from a private endpoint. This configuration disables access from any public address space outside of Azure IP range, and denies all logins that match IP or virtual network-based firewall rules.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.2a4dabc3d087","displayName":"Public network access should be disabled for PostgreSQL servers","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/b52376f7-9612-48a1-81cd-1ffe4b61032c","Azure.Policy/version":"2.0.1"}},"spec":{"recommend":"Disable the public network access property to improve security and ensure your Azure Database for PostgreSQL can only be accessed from a private endpoint. This configuration disables access from any public address space outside of Azure IP range, and denies all logins that match IP or virtual network-based firewall rules.","type":["Microsoft.DBforPostgreSQL/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.publicNetworkAccess","equals":"Disabled"}}},{
// Synopsis: Use customer-managed keys to manage the encryption at rest of your PostgreSQL servers. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8cdb2c652cb3","displayName":"PostgreSQL servers should use customer-managed keys to encrypt data at rest","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/18adea5e-f416-4d0f-8aa8-d24321e3e274","Azure.Policy/version":"1.0.4"}},"spec":{"recommend":"Use customer-managed keys to manage the encryption at rest of your PostgreSQL servers. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management.","type":["Microsoft.DBforPostgreSQL/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.serverKeyType","equals":"AzureKeyVault"},{"field":"properties.uri","notEquals":""},{"field":"properties.uri","exists":true}]}],"where":{"type":".","equals":"Microsoft.DBforPostgreSQL/servers/keys"}}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your VM Image Builder building resources, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/virtual-machines/linux/image-builder-networking#deploy-using-an-existing-vnet.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.0dd0ae3019e9","displayName":"VM Image Builder templates should use private link","tags":{"Azure.Policy/category":"VM Image Builder"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/2154edb9-244f-4741-9970-660785bccdaa","Azure.Policy/version":"1.1.0"}},"spec":{"recommend":"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your VM Image Builder building resources, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/virtual-machines/linux/image-builder-networking#deploy-using-an-existing-vnet.","type":["Microsoft.VirtualMachineImages/imageTemplates"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.vmProfile.vnetConfig","exists":true}}},{
// Synopsis: Azure Private Link lets you connect your virtual networks to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to key vault, you can reduce data leakage risks. Learn more about private links at: https://aka.ms/akvprivatelink.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.4bfa43127093","displayName":"Azure Key Vaults should use private link","tags":{"Azure.Policy/category":"Key Vault"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/a6abeaec-4d90-4a02-805f-6b26c4d3fbe9","Azure.Policy/version":"1.2.1"}},"spec":{"recommend":"Azure Private Link lets you connect your virtual networks to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to key vault, you can reduce data leakage risks. Learn more about private links at: https://aka.ms/akvprivatelink.","type":["Microsoft.KeyVault/vaults"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"less":1,"field":"properties.privateEndpointConnections[*]","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}]}}},{
// Synopsis: Azure Spring Cloud instances should use virtual network injection for the following purposes: 1. Isolate Azure Spring Cloud from Internet. 2. Enable Azure Spring Cloud to interact with systems in either on premises data centers or Azure service in other virtual networks. 3. Empower customers to control inbound and outbound network communications for Azure Spring Cloud.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.bcef010ee2c2","displayName":"Azure Spring Cloud should use network injection","tags":{"Azure.Policy/category":"App Platform"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/af35e2a4-ef96-44e7-a9ae-853dd97032c4","Azure.Policy/version":"1.2.0"}},"spec":{"recommend":"Azure Spring Cloud instances should use virtual network injection for the following purposes: 1. Isolate Azure Spring Cloud from Internet. 2. Enable Azure Spring Cloud to interact with systems in either on premises data centers or Azure service in other virtual networks. 3. Empower customers to control inbound and outbound network communications for Azure Spring Cloud.","type":["Microsoft.AppPlatform/Spring"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"sku.tier","in":["Standard","Enterprise"]},{"field":"properties.networkProfile.serviceRuntimeSubnetId","exists":false}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: To ensure the relevant people in your organization are notified when there is a potential security breach in one of your subscriptions, set a security contact to receive email notifications from Security Center.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.d4c5aec3909e","displayName":"Subscriptions should have a contact email address for security issues","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/4f4f78b8-e367-4b10-a341-d9a4ad5cf1c7","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"To ensure the relevant people in your organization are notified when there is a potential security breach in one of your subscriptions, set a security contact to receive email notifications from Security Center.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.emails","notEquals":""}],"where":{"type":".","equals":"Microsoft.Security/securityContacts"}}}},{
// Synopsis: To monitor for security vulnerabilities and threats, Azure Security Center collects data from your Azure virtual machines. Data is collected by the Log Analytics agent, formerly known as the Microsoft Monitoring Agent (MMA), which reads various security-related configurations and event logs from the machine and copies the data to your Log Analytics workspace for analysis. We recommend enabling auto provisioning to automatically deploy the agent to all supported Azure VMs and any new ones that are created.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.7133c2c987f5","displayName":"Auto provisioning of the Log Analytics agent should be enabled on your subscription","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/475aae12-b88a-4572-8b36-9b712b2b3a17","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"To monitor for security vulnerabilities and threats, Azure Security Center collects data from your Azure virtual machines. Data is collected by the Log Analytics agent, formerly known as the Microsoft Monitoring Agent (MMA), which reads various security-related configurations and event logs from the machine and copies the data to your Log Analytics workspace for analysis. We recommend enabling auto provisioning to automatically deploy the agent to all supported Azure VMs and any new ones that are created.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.autoProvision","equals":"On"}],"where":{"type":".","equals":"Microsoft.Security/autoProvisioningSettings"}}}},{
// Synopsis: To ensure the relevant people in your organization are notified when there is a potential security breach in one of your subscriptions, enable email notifications for high severity alerts in Security Center.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.812ad7c7a843","displayName":"Email notification for high severity alerts should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/6e2593d9-add6-4083-9c9b-4b7d2188c899","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"To ensure the relevant people in your organization are notified when there is a potential security breach in one of your subscriptions, enable email notifications for high severity alerts in Security Center.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.alertNotifications.state","notEquals":"Off"}],"where":{"type":".","equals":"Microsoft.Security/securityContacts"}}}},{
// Synopsis: To ensure your subscription owners are notified when there is a potential security breach in their subscription, set email notifications to subscription owners for high severity alerts in Security Center.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.166e3e032871","displayName":"Email notification to subscription owner for high severity alerts should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0b15565f-aa9e-48ba-8619-45960f2c314d","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"To ensure your subscription owners are notified when there is a potential security breach in their subscription, set email notifications to subscription owners for high severity alerts in Security Center.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"not":{"allOf":[{"field":"properties.notificationsByRole.state","equals":"Off"},{"field":"properties.alertNotifications.minimalSeverity","equals":"High"}]}}],"where":{"type":".","equals":"Microsoft.Security/securityContacts"}}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your storage account, data leakage risks are reduced. Learn more about private links at - https://aka.ms/azureprivatelinkoverview
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.e0edf06a9641","displayName":"Storage accounts should use private link","tags":{"Azure.Policy/category":"Storage"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/6edd7eda-6dd8-40f7-810d-67160c639cd9","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your storage account, data leakage risks are reduced. Learn more about private links at - https://aka.ms/azureprivatelinkoverview","type":["Microsoft.Storage/storageAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}],"where":{"type":".","equals":"Microsoft.Storage/storageAccounts/privateEndpointConnections"}}}},{
// Synopsis: Private endpoint connections enforce secure communication by enabling private connectivity to Azure SQL Database.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.8efae857cf25","displayName":"Private endpoint connections on Azure SQL Database should be enabled","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/7698e800-9299-47a6-b3b6-5a0fee576eed","Azure.Policy/version":"1.1.0"}},"spec":{"recommend":"Private endpoint connections enforce secure communication by enabling private connectivity to Azure SQL Database.","type":["Microsoft.Sql/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"less":1,"field":"properties.privateEndpointConnections[*]","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}]}}},{
// Synopsis: Disabling the public network access property improves security by ensuring your Azure SQL Database can only be accessed from a private endpoint. This configuration denies all logins that match IP or virtual network based firewall rules.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.ec4169bdb2ef","displayName":"Public network access on Azure SQL Database should be disabled","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1b8ca024-1d5c-4dec-8995-b1a932b41780","Azure.Policy/version":"1.1.0"}},"spec":{"recommend":"Disabling the public network access property improves security by ensuring your Azure SQL Database can only be accessed from a private endpoint. This configuration denies all logins that match IP or virtual network based firewall rules.","type":["Microsoft.Sql/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.publicNetworkAccess","equals":"Disabled"}}},{
// Synopsis: Network access to Cognitive Services accounts should be restricted. Configure network rules so only applications from allowed networks can access the Cognitive Services account. To allow connections from specific internet or on-premises clients, access can be granted to traffic from specific Azure virtual networks or to public internet IP address ranges.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.577c98cbcdb4","displayName":"Cognitive Services accounts should restrict network access","tags":{"Azure.Policy/category":"Cognitive Services"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/037eea7a-bd0a-46c5-9a66-03aea78705d3","Azure.Policy/version":"3.0.0"}},"spec":{"recommend":"Network access to Cognitive Services accounts should be restricted. Configure network rules so only applications from allowed networks can access the Cognitive Services account. To allow connections from specific internet or on-premises clients, access can be granted to traffic from specific Azure virtual networks or to public internet IP address ranges.","type":["Microsoft.CognitiveServices/accounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.networkAcls.defaultAction","equals":"Deny"}}},{
// Synopsis: To improve the security of Cognitive Services accounts, ensure that it isn't exposed to the public internet and can only be accessed from a private endpoint. Disable the public network access property as described in https://go.microsoft.com/fwlink/?linkid=2129800. This option disables access from any public address space outside the Azure IP range, and denies all logins that match IP or virtual network-based firewall rules. This reduces data leakage risks.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.9f14fab3a9cd","displayName":"Cognitive Services accounts should disable public network access","tags":{"Azure.Policy/category":"Cognitive Services"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0725b4dd-7e76-479c-a735-68e7ee23d5ca","Azure.Policy/version":"3.0.1"}},"spec":{"recommend":"To improve the security of Cognitive Services accounts, ensure that it isn't exposed to the public internet and can only be accessed from a private endpoint. Disable the public network access property as described in https://go.microsoft.com/fwlink/?linkid=2129800. This option disables access from any public address space outside the Azure IP range, and denies all logins that match IP or virtual network-based firewall rules. This reduces data leakage risks.","type":["Microsoft.CognitiveServices/accounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.publicNetworkAccess","equals":"Disabled"}}},{
// Synopsis: Azure Virtual Network deployment provides enhanced security, isolation and allows you to place your API Management service in a non-internet routable network that you control access to. These networks can then be connected to your on-premises networks using various VPN technologies, which enables access to your backend services within the network and/or on-premises. The developer portal and API gateway, can be configured to be accessible either from the Internet or only within the virtual network.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.3fa87a9e7388","displayName":"API Management services should use a virtual network","tags":{"Azure.Policy/category":"API Management"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/ef619a2c-cc4d-4d03-b2ba-8c94a834d85b","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Azure Virtual Network deployment provides enhanced security, isolation and allows you to place your API Management service in a non-internet routable network that you control access to. These networks can then be connected to your on-premises networks using various VPN technologies, which enables access to your backend services within the network and/or on-premises. The developer portal and API gateway, can be configured to be accessible either from the Internet or only within the virtual network.","type":["Microsoft.ApiManagement/service"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"sku.name","in":["Developer","Premium"]},{"anyOf":[{"field":"properties.virtualNetworkType","exists":false},{"field":"properties.virtualNetworkType","equals":"None"}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Firewall rules should be defined on your Azure Cosmos DB accounts to prevent traffic from unauthorized sources. Accounts that have at least one IP rule defined with the virtual network filter enabled are deemed compliant. Accounts disabling public access are also deemed compliant.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.b0bdd4d020a4","displayName":"Azure Cosmos DB accounts should have firewall rules","tags":{"Azure.Policy/category":"Cosmos DB"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/862e97cf-49fc-4a5c-9de4-40d4e2e7c8eb","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Firewall rules should be defined on your Azure Cosmos DB accounts to prevent traffic from unauthorized sources. Accounts that have at least one IP rule defined with the virtual network filter enabled are deemed compliant. Accounts disabling public access are also deemed compliant.","type":["Microsoft.DocumentDB/databaseAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"where":{"allOf":[{"anyOf":[{"field":"properties.publicNetworkAccess","exists":false},{"field":"properties.publicNetworkAccess","equals":"Enabled"}]},{"anyOf":[{"field":"properties.isVirtualNetworkFilterEnabled","exists":false},{"field":"properties.isVirtualNetworkFilterEnabled","equals":"false"}]},{"allOf":[{"anyOf":[{"field":"properties.ipRules","exists":false},{"equals":0,"field":"properties.ipRules[*]"}]},{"anyOf":[{"field":"properties.ipRangeFilter","exists":false},{"field":"properties.ipRangeFilter","equals":""}]}]}]},"condition":{"value":"Deny","equals":false}}},{
// Synopsis: Resource logs enable recreating activity trails to use for investigation purposes when a security incident occurs or when your network is compromised.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.c8a41c412043","displayName":"Resource logs in Azure Machine Learning Workspaces should be enabled","tags":{"Azure.Policy/category":"Machine Learning"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/afe0c3be-ba3b-4544-ba52-0c99672a8ad6","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"Resource logs enable recreating activity trails to use for investigation purposes when a security incident occurs or when your network is compromised.","type":["Microsoft.MachineLearningServices/workspaces"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Disabling public network access improves security by ensuring that the Machine Learning Workspaces aren't exposed on the public internet. You can control exposure of your workspaces by creating private endpoints instead. Learn more at: https://learn.microsoft.com/azure/machine-learning/how-to-configure-private-link?view=azureml-api-2&tabs=azure-portal.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.e921497a79f9","displayName":"Azure Machine Learning Workspaces should disable public network access","tags":{"Azure.Policy/category":"Machine Learning"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/438c38d2-3772-465a-a9cc-7a6666a275ce","Azure.Policy/version":"2.0.1"}},"spec":{"recommend":"Disabling public network access improves security by ensuring that the Machine Learning Workspaces aren't exposed on the public internet. You can control exposure of your workspaces by creating private endpoints instead. Learn more at: https://learn.microsoft.com/azure/machine-learning/how-to-configure-private-link?view=azureml-api-2&tabs=azure-portal.","type":["Microsoft.MachineLearningServices/workspaces"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"field":"properties.publicNetworkAccess","exists":false},{"field":"properties.publicNetworkAccess","notEquals":"Disabled"}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Disabling local authentication methods improves security by ensuring that Machine Learning Computes require Azure Active Directory identities exclusively for authentication. Learn more at: https://aka.ms/azure-ml-aad-policy.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.b44506d29c17","displayName":"Azure Machine Learning Computes should have local authentication methods disabled","tags":{"Azure.Policy/category":"Machine Learning"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/e96a9a5f-07ca-471b-9bc5-6a0f33cbd68f","Azure.Policy/version":"2.0.1"}},"spec":{"recommend":"Disabling local authentication methods improves security by ensuring that Machine Learning Computes require Azure Active Directory identities exclusively for authentication. Learn more at: https://aka.ms/azure-ml-aad-policy.","type":["Microsoft.MachineLearningServices/workspaces/computes"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"properties.disableLocalAuth","equals":true}}},{
// Synopsis: Ensure Azure Machine Learning compute instances run on the latest available operating system. Security is improved and vulnerabilities reduced by running with the latest security patches. For more information, visit https://aka.ms/azureml-ci-updates/.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.d477656dcc98","displayName":"Azure Machine Learning compute instances should be recreated to get the latest software updates","tags":{"Azure.Policy/category":"Machine Learning"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/f110a506-2dcb-422e-bcea-d533fc8c35e2","Azure.Policy/version":"1.0.3"}},"spec":{"recommend":"Ensure Azure Machine Learning compute instances run on the latest available operating system. Security is improved and vulnerabilities reduced by running with the latest security patches. For more information, visit https://aka.ms/azureml-ci-updates/.","type":["Microsoft.MachineLearningServices/workspaces/computes"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"where":{"allOf":[{"field":"properties.computeType","equals":"ComputeInstance"},{"field":"properties.properties.osImageMetadata.isLatestOsImageVersion","equals":"false"}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Resource logs enable recreating activity trails to use for investigation purposes when a security incident occurs or when your network is compromised.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.76cba4a287e0","displayName":"Resource logs in Azure Databricks Workspaces should be enabled","tags":{"Azure.Policy/category":"Azure Databricks"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/138ff14d-b687-4faa-a81c-898c91a87fa2","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"Resource logs enable recreating activity trails to use for investigation purposes when a security incident occurs or when your network is compromised.","type":["Microsoft.Databricks/workspaces"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Disabling public network access improves security by ensuring that the resource isn't exposed on the public internet. You can control exposure of your resources by creating private endpoints instead. Learn more at: https://learn.microsoft.com/azure/databricks/administration-guide/cloud-configurations/azure/private-link. 
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.996a960ce7ae","displayName":"Azure Databricks Workspaces should disable public network access","tags":{"Azure.Policy/category":"Azure Databricks"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0e7849de-b939-4c50-ab48-fc6b0f5eeba2","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"Disabling public network access improves security by ensuring that the resource isn't exposed on the public internet. You can control exposure of your resources by creating private endpoints instead. Learn more at: https://learn.microsoft.com/azure/databricks/administration-guide/cloud-configurations/azure/private-link. ","type":["Microsoft.Databricks/workspaces"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.publicNetworkAccess","equals":"Disabled"}}},{
// Synopsis: Disabling public IP of clusters in Azure Databricks Workspaces improves security by ensuring that the clusters aren't exposed on the public internet. Learn more at: https://learn.microsoft.com/azure/databricks/security/secure-cluster-connectivity.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.0bb54078bba9","displayName":"Azure Databricks Clusters should disable public IP","tags":{"Azure.Policy/category":"Azure Databricks"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/51c1490f-3319-459c-bbbc-7f391bbed753","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"Disabling public IP of clusters in Azure Databricks Workspaces improves security by ensuring that the clusters aren't exposed on the public internet. Learn more at: https://learn.microsoft.com/azure/databricks/security/secure-cluster-connectivity.","type":["Microsoft.Databricks/workspaces"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.parameters.enableNoPublicIp.value","equals":"true"}}},{
// Synopsis: Azure Virtual Networks provide enhanced security and isolation for your Azure Databricks Workspaces, as well as subnets, access control policies, and other features to further restrict access. Learn more at: https://docs.microsoft.com/azure/databricks/administration-guide/cloud-configurations/azure/vnet-inject.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.9c725ef4801a","displayName":"Azure Databricks Workspaces should be in a virtual network","tags":{"Azure.Policy/category":"Azure Databricks"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/9c25c9e4-ee12-4882-afd2-11fb9d87893f","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Azure Virtual Networks provide enhanced security and isolation for your Azure Databricks Workspaces, as well as subnets, access control policies, and other features to further restrict access. Learn more at: https://docs.microsoft.com/azure/databricks/administration-guide/cloud-configurations/azure/vnet-inject.","type":["Microsoft.Databricks/workspaces"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"field":"properties.parameters.customPublicSubnetName.value","exists":false},{"field":"properties.parameters.customPrivateSubnetName.value","exists":false},{"field":"properties.parameters.customVirtualNetworkId.value","exists":false}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Azure Private Link lets you connect your virtual networks to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to Azure Databricks workspaces, you can reduce data leakage risks. Learn more about private links at: https://aka.ms/adbpe.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.9efa922be6ac","displayName":"Azure Databricks Workspaces should use private link","tags":{"Azure.Policy/category":"Azure Databricks"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/258823f2-4595-4b52-b333-cc96192710d8","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Azure Private Link lets you connect your virtual networks to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to Azure Databricks workspaces, you can reduce data leakage risks. Learn more about private links at: https://aka.ms/adbpe.","type":["Microsoft.Databricks/workspaces"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"less":1,"field":"properties.privateEndpointConnections[*]","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}]}}},{
// Synopsis: Azure Defender for Resource Manager automatically monitors the resource management operations in your organization. Azure Defender detects threats and alerts you about suspicious activity. Learn more about the capabilities of Azure Defender for Resource Manager at https://aka.ms/defender-for-resource-manager . Enabling this Azure Defender plan results in charges. Learn about the pricing details per region on Security Center's pricing page: https://aka.ms/pricing-security-center .
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.5e26eec9c179","displayName":"Azure Defender for Resource Manager should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/c3d20c29-b36d-48fe-808b-99a87530ad99","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Azure Defender for Resource Manager automatically monitors the resource management operations in your organization. Azure Defender detects threats and alerts you about suspicious activity. Learn more about the capabilities of Azure Defender for Resource Manager at https://aka.ms/defender-for-resource-manager . Enabling this Azure Defender plan results in charges. Learn about the pricing details per region on Security Center's pricing page: https://aka.ms/pricing-security-center .","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"Arm"}]}}}},{
// Synopsis: Azure Defender for DNS provides an additional layer of protection for your cloud resources by continuously monitoring all DNS queries from your Azure resources. Azure Defender alerts you about suspicious activity at the DNS layer. Learn more about the capabilities of Azure Defender for DNS at https://aka.ms/defender-for-dns . Enabling this Azure Defender plan results in charges. Learn about the pricing details per region on Security Center's pricing page: https://aka.ms/pricing-security-center .
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.970d5caf64eb","displayName":"Azure Defender for DNS should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/bdc59948-5574-49b3-bb91-76b7c986428d","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Azure Defender for DNS provides an additional layer of protection for your cloud resources by continuously monitoring all DNS queries from your Azure resources. Azure Defender alerts you about suspicious activity at the DNS layer. Learn more about the capabilities of Azure Defender for DNS at https://aka.ms/defender-for-dns . Enabling this Azure Defender plan results in charges. Learn about the pricing details per region on Security Center's pricing page: https://aka.ms/pricing-security-center .","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"Dns"}]}}}},{
// Synopsis: Enable virtual TPM device on supported virtual machines to facilitate Measured Boot and other OS security features that require a TPM. Once enabled, vTPM can be used to attest boot integrity. This assessment only applies to trusted launch enabled virtual machines.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.220e86316e9e","displayName":"[Preview]: vTPM should be enabled on supported virtual machines","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1c30f9cd-b84c-49cc-aa2c-9288447cc3b3","Azure.Policy/version":"2.0.0-preview"}},"spec":{"recommend":"Enable virtual TPM device on supported virtual machines to facilitate Measured Boot and other OS security features that require a TPM. Once enabled, vTPM can be used to attest boot integrity. This assessment only applies to trusted launch enabled virtual machines.","type":["Microsoft.Compute/virtualMachines"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"properties.securityProfile.securityType","equals":"TrustedLaunch"},{"field":"properties.securityProfile.uefiSettings","exists":true},{"field":"properties.securityProfile.uefiSettings.vTpmEnabled","notEquals":"true"}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Enable Secure Boot on supported Windows virtual machines to mitigate against malicious and unauthorized changes to the boot chain. Once enabled, only trusted bootloaders, kernel and kernel drivers will be allowed to run. This assessment applies to Trusted Launch and Confidential Windows virtual machines.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.0e496d3a47ef","displayName":"[Preview]: Secure Boot should be enabled on supported Windows virtual machines","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/97566dd7-78ae-4997-8b36-1c7bfe0d8121","Azure.Policy/version":"4.0.0-preview"}},"spec":{"recommend":"Enable Secure Boot on supported Windows virtual machines to mitigate against malicious and unauthorized changes to the boot chain. Once enabled, only trusted bootloaders, kernel and kernel drivers will be allowed to run. This assessment applies to Trusted Launch and Confidential Windows virtual machines.","type":["Microsoft.Compute/virtualMachines"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"anyOf":[{"field":"properties.storageProfile.imageReference.offer","like":"windows*"},{"field":"properties.storageProfile.osDisk.osType","like":"Windows*"}]},{"field":"properties.securityProfile.securityType","in":["TrustedLaunch","ConfidentialVM"]},{"field":"properties.securityProfile.uefiSettings","exists":true},{"field":"properties.securityProfile.uefiSettings.secureBootEnabled","notEquals":"true"}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Install Guest Attestation extension on supported Linux virtual machines to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation. This assessment applies to Trusted Launch and Confidential Linux virtual machines.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.ae3b44156aaa","displayName":"[Preview]: Guest Attestation extension should be installed on supported Linux virtual machines","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/672fe5a1-2fcd-42d7-b85d-902b6e28c6ff","Azure.Policy/version":"6.0.0-preview"}},"spec":{"recommend":"Install Guest Attestation extension on supported Linux virtual machines to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation. This assessment applies to Trusted Launch and Confidential Linux virtual machines.","type":["Microsoft.Compute/virtualMachines"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"anyOf":[{"field":"properties.storageProfile.osDisk.osType","like":"Linux*"},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.storageProfile.imageReference.offer","equals":"UbuntuServer"},{"field":"properties.storageProfile.imageReference.sku","like":"18_04-lts-gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.storageProfile.imageReference.offer","equals":"0001-com-ubuntu-server-focal"},{"field":"properties.storageProfile.imageReference.sku","like":"20_04-lts-gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.storageProfile.imageReference.offer","equals":"0001-com-ubuntu-confidential-vm-focal"},{"field":"properties.storageProfile.imageReference.sku","like":"20_04-lts-cvm"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"RedHat"},{"field":"properties.storageProfile.imageReference.offer","equals":"RHEL"},{"field":"properties.storageProfile.imageReference.sku","like":"83-gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"SUSE"},{"field":"properties.storageProfile.imageReference.offer","equals":"SLES-15-SP2"},{"field":"properties.storageProfile.imageReference.sku","like":"gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"OpenLogic"},{"field":"properties.storageProfile.imageReference.offer","equals":"CENTOS"},{"field":"properties.storageProfile.imageReference.sku","equals":"8_3-gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"Oracle"},{"field":"properties.storageProfile.imageReference.offer","equals":"Oracle-Linux"},{"field":"properties.storageProfile.imageReference.sku","equals":"ol83-lvm-gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"microsoftcblmariner"},{"field":"properties.storageProfile.imageReference.offer","equals":"cbl-mariner"},{"field":"properties.storageProfile.imageReference.sku","equals":"1-gen2"}]},{"allOf":[{"field":"properties.storageProfile.imageReference.publisher","equals":"debian"},{"field":"properties.storageProfile.imageReference.offer","equals":"debian-11"},{"field":"properties.storageProfile.imageReference.sku","equals":"11-gen2"}]}]},{"field":"properties.securityProfile.securityType","in":["TrustedLaunch","ConfidentialVM"]},{"field":"properties.securityProfile.uefiSettings","exists":true},{"field":"properties.securityProfile.uefiSettings.secureBootEnabled","equals":"true"},{"field":"properties.securityProfile.uefiSettings.vTpmEnabled","equals":"true"}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.publisher","equals":"Microsoft.Azure.Security.LinuxAttestation"},{"field":"properties.type","equals":"GuestAttestation"},{"field":"properties.provisioningState","in":["Succeeded","Provisioning succeeded"]}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachines/extensions"}}}},{
// Synopsis: Install Guest Attestation extension on supported Linux virtual machines scale sets to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation.  This assessment applies to Trusted Launch and Confidential Linux virtual machine scale sets.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.18da19e12c56","displayName":"[Preview]: Guest Attestation extension should be installed on supported Linux virtual machines scale sets","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/a21f8c92-9e22-4f09-b759-50500d1d2dda","Azure.Policy/version":"5.1.0-preview"}},"spec":{"recommend":"Install Guest Attestation extension on supported Linux virtual machines scale sets to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation.  This assessment applies to Trusted Launch and Confidential Linux virtual machine scale sets.","type":["Microsoft.Compute/virtualMachineScaleSets"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"anyOf":[{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"UbuntuServer"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","like":"18_04-lts-gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"0001-com-ubuntu-server-focal"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","like":"20_04-lts-gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"Canonical"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"0001-com-ubuntu-confidential-vm-focal"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","like":"20_04-lts-cvm"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"RedHat"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"RHEL"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","like":"83-gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"SUSE"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"SLES-15-SP2"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","like":"gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"OpenLogic"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"CENTOS"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","equals":"8_3-gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"Oracle"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"Oracle-Linux"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","equals":"ol83-lvm-gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"microsoftcblmariner"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"cbl-mariner"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","equals":"1-gen2"}]},{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.publisher","equals":"debian"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","equals":"debian-11"},{"field":"properties.virtualMachineProfile.storageProfile.imageReference.sku","equals":"11-gen2"}]}]},{"field":"properties.virtualMachineProfile.securityProfile.securityType","in":["TrustedLaunch","ConfidentialVM"]},{"field":"properties.virtualMachineProfile.securityProfile.uefiSettings","exists":true},{"field":"properties.virtualMachineProfile.securityProfile.uefiSettings.vTpmEnabled","equals":"true"},{"field":"properties.virtualMachineProfile.securityProfile.uefiSettings.secureBootEnabled","equals":"true"}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.publisher","equals":"Microsoft.Azure.Security.LinuxAttestation"},{"field":"properties.type","equals":"GuestAttestation"}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachineScaleSets/extensions"}}}},{
// Synopsis: Install Guest Attestation extension on supported virtual machines to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation. This assessment applies to Trusted Launch and Confidential Windows virtual machines.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.a44fe2ad0fc4","displayName":"[Preview]: Guest Attestation extension should be installed on supported Windows virtual machines","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1cb4d9c2-f88f-4069-bee0-dba239a57b09","Azure.Policy/version":"4.0.0-preview"}},"spec":{"recommend":"Install Guest Attestation extension on supported virtual machines to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation. This assessment applies to Trusted Launch and Confidential Windows virtual machines.","type":["Microsoft.Compute/virtualMachines"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"anyOf":[{"field":"properties.storageProfile.imageReference.offer","like":"windows*"},{"field":"properties.storageProfile.osDisk.osType","like":"Windows*"}]},{"field":"properties.securityProfile.securityType","in":["TrustedLaunch","ConfidentialVM"]},{"field":"properties.securityProfile.uefiSettings","exists":true},{"field":"properties.securityProfile.uefiSettings.secureBootEnabled","equals":"true"},{"field":"properties.securityProfile.uefiSettings.vTpmEnabled","equals":"true"}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.publisher","equals":"Microsoft.Azure.Security.WindowsAttestation"},{"field":"properties.type","equals":"GuestAttestation"},{"field":"properties.provisioningState","in":["Succeeded","Provisioning succeeded"]}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachines/extensions"}}}},{
// Synopsis: Install Guest Attestation extension on supported virtual machines scale sets to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation. This assessment applies to Trusted Launch and Confidential Windows virtual machine scale sets.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.a2cf41848ed4","displayName":"[Preview]: Guest Attestation extension should be installed on supported Windows virtual machines scale sets","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/f655e522-adff-494d-95c2-52d4f6d56a42","Azure.Policy/version":"3.1.0-preview"}},"spec":{"recommend":"Install Guest Attestation extension on supported virtual machines scale sets to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation. This assessment applies to Trusted Launch and Confidential Windows virtual machine scale sets.","type":["Microsoft.Compute/virtualMachineScaleSets"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"properties.virtualMachineProfile.storageProfile.imageReference.offer","like":"windows*"},{"field":"properties.virtualMachineProfile.securityProfile.securityType","in":["TrustedLaunch","ConfidentialVM"]},{"field":"properties.virtualMachineProfile.securityProfile.uefiSettings","exists":true},{"field":"properties.virtualMachineProfile.securityProfile.uefiSettings.vTpmEnabled","equals":"true"},{"field":"properties.virtualMachineProfile.securityProfile.uefiSettings.secureBootEnabled","equals":"true"}]},"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.publisher","equals":"Microsoft.Azure.Security.WindowsAttestation"},{"field":"properties.type","equals":"GuestAttestation"}]}],"where":{"type":".","equals":"Microsoft.Compute/virtualMachineScaleSets/extensions"}}}},{
// Synopsis: Azure Kubernetes Service's resource logs can help recreate activity trails when investigating security incidents. Enable it to make sure the logs will exist when needed
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.3793ca33a55d","displayName":"Resource logs in Azure Kubernetes Service should be enabled","tags":{"Azure.Policy/category":"Kubernetes"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/245fc9df-fa96-4414-9a0b-3738c2f7341c","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Azure Kubernetes Service's resource logs can help recreate activity trails when investigating security incidents. Enable it to make sure the logs will exist when needed","type":["Microsoft.ContainerService/managedClusters"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"greaterOrEqual":1,"field":"properties.logs[*]","anyOf":[{"allOf":[{"field":"retentionPolicy.enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.days","equals":"0"},{"value":{"$":{"padLeft":{"path":"retentionPolicy.days"},"totalLength":3,"paddingCharacter":"0"}},"greaterOrEquals":365,"convert":true}]},{"field":"enabled","equals":"true"}]},{"allOf":[{"field":"enabled","equals":"true"},{"anyOf":[{"field":"retentionPolicy.enabled","notEquals":"true"},{"field":"properties.storageAccountId","exists":false}]}]}]}],"where":{"type":".","equals":"Microsoft.Insights/diagnosticSettings"}}}},{
// Synopsis: Azure Defender for open-source relational databases detects anomalous activities indicating unusual and potentially harmful attempts to access or exploit databases. Learn more about the capabilities of Azure Defender for open-source relational databases at https://aka.ms/AzDforOpenSourceDBsDocu. Important: Enabling this plan will result in charges for protecting your open-source relational databases. Learn about the pricing on Security Center's pricing page: https://aka.ms/pricing-security-center
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.a4a39cffd114","displayName":"Azure Defender for open-source relational databases should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/0a9fbe0d-c5c4-4da8-87d8-f4fd77338835","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Azure Defender for open-source relational databases detects anomalous activities indicating unusual and potentially harmful attempts to access or exploit databases. Learn more about the capabilities of Azure Defender for open-source relational databases at https://aka.ms/AzDforOpenSourceDBsDocu. Important: Enabling this plan will result in charges for protecting your open-source relational databases. Learn about the pricing on Security Center's pricing page: https://aka.ms/pricing-security-center","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"OpenSourceRelationalDatabases"}]}}}},{
// Synopsis: Defender Cloud Security Posture Management (CSPM) provides enhanced posture capabilities and a new intelligent cloud security graph to help identify, prioritize, and reduce risk. Defender CSPM is available in addition to the free foundational security posture capabilities turned on by default in Defender for Cloud.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.c4ea4e66c3ab","displayName":"Microsoft Defender CSPM should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/1f90fc71-a595-4066-8974-d4d0802e8ef0","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Defender Cloud Security Posture Management (CSPM) provides enhanced posture capabilities and a new intelligent cloud security graph to help identify, prioritize, and reduce risk. Defender CSPM is available in addition to the free foundational security posture capabilities turned on by default in Defender for Cloud.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"field":"properties.pricingTier","equals":"Standard"}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"CloudPosture"}]}}}},{
// Synopsis: Disabling local authentication methods and allowing only Microsoft Entra authentication improves security by ensuring that Azure SQL Databases can exclusively be accessed by Microsoft Entra identities. Learn more at: aka.ms/adonlycreate.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.0fd23f5f9598","displayName":"Azure SQL Database should have Microsoft Entra-only authentication enabled","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/abda6d70-9778-44e7-84a8-06713e6db027","Azure.Policy/version":"1.1.0"}},"spec":{"recommend":"Disabling local authentication methods and allowing only Microsoft Entra authentication improves security by ensuring that Azure SQL Databases can exclusively be accessed by Microsoft Entra identities. Learn more at: aka.ms/adonlycreate.","type":["Microsoft.Sql/servers","Microsoft.Sql/servers/azureADOnlyAuthentications"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"allOf":[{"equals":"Microsoft.Sql/servers","type":"."},{"value":"eastus","notContains":"/providers/Microsoft.Synapse/"},{"anyOf":[{"field":"properties.administrators.azureADOnlyAuthentication","exists":false},{"field":"properties.administrators.azureADOnlyAuthentication","equals":"false"}]}]},{"allOf":[{"equals":"Microsoft.Sql/servers/azureADOnlyAuthentications","type":"."},{"value":"eastus","notContains":"/providers/Microsoft.Synapse/"},{"anyOf":[{"field":"properties.azureADOnlyAuthentication","exists":false},{"field":"properties.azureADOnlyAuthentication","equals":"false"}]}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Audit provisioning of an Azure Active Directory administrator for your MySQL server to enable Azure AD authentication. Azure AD authentication enables simplified permission management and centralized identity management of database users and other Microsoft services
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.983ac3031758","displayName":"An Azure Active Directory administrator should be provisioned for MySQL servers","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/146412e9-005c-472b-9e48-c87b72ac229e","Azure.Policy/version":"1.1.0"}},"spec":{"recommend":"Audit provisioning of an Azure Active Directory administrator for your MySQL server to enable Azure AD authentication. Azure AD authentication enables simplified permission management and centralized identity management of database users and other Microsoft services","type":["Microsoft.DBforMySQL/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"value":true,"equals":true}],"where":{"type":".","equals":"Microsoft.DBforMySQL/servers/administrators"}}}},{
// Synopsis: Audit provisioning of an Azure Active Directory administrator for your PostgreSQL server to enable Azure AD authentication. Azure AD authentication enables simplified permission management and centralized identity management of database users and other Microsoft services
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.fe0e74b8f954","displayName":"An Azure Active Directory administrator should be provisioned for PostgreSQL servers","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/b4dec045-250a-48c2-b5cc-e0c4eec8b5b4","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Audit provisioning of an Azure Active Directory administrator for your PostgreSQL server to enable Azure AD authentication. Azure AD authentication enables simplified permission management and centralized identity management of database users and other Microsoft services","type":["Microsoft.DBforPostgreSQL/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"value":true,"equals":true}],"where":{"type":".","equals":"Microsoft.DBforPostgreSQL/servers/administrators"}}}},{
// Synopsis: Disabling local authentication methods and allowing only Microsoft Entra authentication improves security by ensuring that Azure SQL Managed Instances can exclusively be accessed by Microsoft Entra identities. Learn more at: aka.ms/adonlycreate.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.eeb50be9b73c","displayName":"Azure SQL Managed Instance should have Microsoft Entra-only authentication enabled","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/78215662-041e-49ed-a9dd-5385911b3a1f","Azure.Policy/version":"1.1.0"}},"spec":{"recommend":"Disabling local authentication methods and allowing only Microsoft Entra authentication improves security by ensuring that Azure SQL Managed Instances can exclusively be accessed by Microsoft Entra identities. Learn more at: aka.ms/adonlycreate.","type":["Microsoft.Sql/managedInstances","Microsoft.Sql/managedInstances/azureADOnlyAuthentications"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"allOf":[{"equals":"Microsoft.Sql/managedInstances","type":"."},{"anyOf":[{"field":"properties.administrators.azureADOnlyAuthentication","exists":false},{"field":"properties.administrators.azureADOnlyAuthentication","equals":"false"}]}]},{"allOf":[{"equals":"Microsoft.Sql/managedInstances/azureADOnlyAuthentications","type":"."},{"anyOf":[{"field":"properties.azureADOnlyAuthentication","exists":false},{"field":"properties.azureADOnlyAuthentication","equals":"false"}]}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: API Management subscriptions should be scoped to a product or an individual API instead of all APIs, which could result in an excessive data exposure.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.94128ffa7d45","displayName":"API Management subscriptions should not be scoped to all APIs","tags":{"Azure.Policy/category":"API Management"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/3aa03346-d8c5-4994-a5bc-7652c2a2aef1","Azure.Policy/version":"1.1.0"}},"spec":{"recommend":"API Management subscriptions should be scoped to a product or an individual API instead of all APIs, which could result in an excessive data exposure.","type":["Microsoft.ApiManagement/service/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"where":{"allOf":[{"field":"properties.scope","like":"*/apis"},{"field":"properties.state","equals":"active"}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: To improve the API security, API Management should validate the backend server certificate for all API calls. Enable SSL certificate thumbprint and name validation.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.5b63d07ccd2e","displayName":"API Management calls to API backends should not bypass certificate thumbprint or name validation","tags":{"Azure.Policy/category":"API Management"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/92bb331d-ac71-416a-8c91-02f2cb734ce4","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"To improve the API security, API Management should validate the backend server certificate for all API calls. Enable SSL certificate thumbprint and name validation.","type":["Microsoft.ApiManagement/service/backends"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"where":{"anyof":[{"field":"properties.tls.validateCertificateChain","equals":false},{"field":"properties.tls.validateCertificateName","equals":false}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: To ensure security of data in transit, APIs should be available only through encrypted protocols, like HTTPS or WSS. Avoid using unsecured protocols, such as HTTP or WS.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.7c8b7c9be08c","displayName":"API Management APIs should use only encrypted protocols","tags":{"Azure.Policy/category":"API Management"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/ee7495e7-3ba7-40b6-bfee-c29e22cc75d4","Azure.Policy/version":"2.0.2"}},"spec":{"recommend":"To ensure security of data in transit, APIs should be available only through encrypted protocols, like HTTPS or WSS. Avoid using unsecured protocols, such as HTTP or WS.","type":["Microsoft.ApiManagement/service/apis"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"greaterOrEqual":1,"field":"properties.protocols[*]","anyOf":[{"field":".","equals":"http"},{"field":".","equals":"ws"}]}}},{
// Synopsis: Named values are a collection of name and value pairs in each API Management service. Secret values can be stored either as encrypted text in API Management (custom secrets) or by referencing secrets in Azure Key Vault. To improve security of API Management and secrets, reference secret named values from Azure Key Vault. Azure Key Vault supports granular access management and secret rotation policies.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.86096bf70cc8","displayName":"API Management secret named values should be stored in Azure Key Vault","tags":{"Azure.Policy/category":"API Management"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/f1cc7827-022c-473e-836e-5a51cae0b249","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"Named values are a collection of name and value pairs in each API Management service. Secret values can be stored either as encrypted text in API Management (custom secrets) or by referencing secrets in Azure Key Vault. To improve security of API Management and secrets, reference secret named values from Azure Key Vault. Azure Key Vault supports granular access management and secret rotation policies.","type":["Microsoft.ApiManagement/service/namedValues"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"where":{"allOf":[{"field":"properties.displayName","exists":true},{"field":"properties.secret","equals":"true"},{"anyOf":[{"field":"properties.keyVault","exists":false},{"field":"properties.keyVault.secretIdentifier","exists":false}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: The direct management REST API in Azure API Management bypasses Azure Resource Manager role-based access control, authorization, and throttling mechanisms, thus increasing the vulnerability of your service.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.88baab474cac","displayName":"API Management direct management endpoint should not be enabled","tags":{"Azure.Policy/category":"API Management"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/b741306c-968e-4b67-b916-5675e5c709f4","Azure.Policy/version":"1.0.2"}},"spec":{"recommend":"The direct management REST API in Azure API Management bypasses Azure Resource Manager role-based access control, authorization, and throttling mechanisms, thus increasing the vulnerability of your service.","type":["Microsoft.ApiManagement/service/tenant"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"properties.enabled","notEquals":true}}},{
// Synopsis: To improve the security of API Management services, restrict connectivity to service configuration endpoints, like direct access management API, Git configuration management endpoint, or self-hosted gateways configuration endpoint.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.aea4f9737bd2","displayName":"API Management should disable public network access to the service configuration endpoints","tags":{"Azure.Policy/category":"API Management"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/df73bd95-24da-4a4f-96b9-4e8b94b402bd","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"To improve the security of API Management services, restrict connectivity to service configuration endpoints, like direct access management API, Git configuration management endpoint, or self-hosted gateways configuration endpoint.","type":["Microsoft.ApiManagement/service"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"field":"sku.name","notEquals":"Consumption"},"condition":{"field":"resources","allOf":[{"field":"properties.enabled","equals":false}],"where":{"allOf":[{"type":".","equals":"Microsoft.ApiManagement/service/tenant"},{"name":".","equals":"[if(equals(parameters('endpointType'), 'Management'), 'access', if(equals(parameters('endpointType'), 'Git'), 'gitaccess', 'gatewayaccess'))]"}]}}}},{
// Synopsis: To prevent service secrets from being shared with read-only users, the minimum API version should be set to 2019-12-01 or higher.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.07cc0d6d3528","displayName":"API Management minimum API version should be set to 2019-12-01 or higher","tags":{"Azure.Policy/category":"API Management"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/549814b6-3212-4203-bdc8-1548d342fb67","Azure.Policy/version":"1.0.1"}},"spec":{"recommend":"To prevent service secrets from being shared with read-only users, the minimum API version should be set to 2019-12-01 or higher.","type":["Microsoft.ApiManagement/service"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"properties.apiVersionConstraint.minApiVersion","notMatch":"2019-12-01"},{"field":"properties.apiVersionConstraint.minApiVersion","notMatch":"202#-##-##-preview"},{"field":"properties.apiVersionConstraint.minApiVersion","notMatch":"202#-##-##"},{"field":"sku.name","notEquals":"Consumption"}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Disabling local authentication methods and allowing only Azure Active Directory Authentication improves security by ensuring that Azure MySQL flexible server can exclusively be accessed by Azure Active Directory identities.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.55ef0a0a3a46","displayName":"Azure MySQL flexible server should have Azure Active Directory Only Authentication enabled","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/40e85574-ef33-47e8-a854-7a65c7500560","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Disabling local authentication methods and allowing only Azure Active Directory Authentication improves security by ensuring that Azure MySQL flexible server can exclusively be accessed by Azure Active Directory identities.","type":["Microsoft.DBForMySql/flexibleServers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"resources","allOf":[{"field":"properties.value","equals":"ON"}],"where":{"allOf":[{"type":".","equals":"Microsoft.DBForMySql/flexibleServers/configurations"},{"name":".","equals":"aad_auth_only"}]}}}},{
// Synopsis: Microsoft Defender for Storage detects potential threats to your storage accounts. It helps prevent the three major impacts on your data and workload: malicious file uploads, sensitive data exfiltration, and data corruption. The new Defender for Storage plan includes Malware Scanning and Sensitive Data Threat Detection. This plan also provides a predictable pricing structure (per storage account) for control over coverage and costs.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.df4245dc6c24","displayName":"Microsoft Defender for Storage should be enabled","tags":{"Azure.Policy/category":"Security Center"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/640d2586-54d2-465f-877f-9ffc1d2109f4","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Microsoft Defender for Storage detects potential threats to your storage accounts. It helps prevent the three major impacts on your data and workload: malicious file uploads, sensitive data exfiltration, and data corruption. The new Defender for Storage plan includes Malware Scanning and Sensitive Data Threat Detection. This plan also provides a predictable pricing structure (per storage account) for control over coverage and costs.","type":["Microsoft.Resources/subscriptions"],"with":["PSRule.Rules.Azure\\Azure.Policy.All"],"condition":{"field":"resources","allOf":[{"allOf":[{"field":"properties.pricingTier","equals":"Standard"},{"field":"properties.subPlan","equals":"DefenderForStorageV2"},{"count":2,"field":"properties.extensions[*]","allOf":[{"field":"name","in":["OnUploadMalwareScanning","SensitiveDataDiscovery"]},{"field":"isEnabled","equals":"true"}]}]}],"where":{"allOf":[{"type":".","equals":"Microsoft.Security/pricings"},{"name":".","equals":"StorageAccounts"}]}}}},{
// Synopsis: Azure Private Link lets you connect your virtual networks to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to Cognitive Services, you'll reduce the potential for data leakage. Learn more about private links at: https://go.microsoft.com/fwlink/?linkid=2129800.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.bf55505c936e","displayName":"Cognitive Services should use private link","tags":{"Azure.Policy/category":"Cognitive Services"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/cddd188c-4b82-4c48-a19d-ddf74ee66a01","Azure.Policy/version":"3.0.0"}},"spec":{"recommend":"Azure Private Link lets you connect your virtual networks to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to Cognitive Services, you'll reduce the potential for data leakage. Learn more about private links at: https://go.microsoft.com/fwlink/?linkid=2129800.","type":["Microsoft.CognitiveServices/accounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"less":1,"field":"properties.privateEndpointConnections[*]","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}]}}},{
// Synopsis: Use encryption at host to get end-to-end encryption for your virtual machine and virtual machine scale set data. Encryption at host enables encryption at rest for your temporary disk and OS/data disk caches. Temporary and ephemeral OS disks are encrypted with platform-managed keys when encryption at host is enabled. OS/data disk caches are encrypted at rest with either customer-managed or platform-managed key, depending on the encryption type selected on the disk. Learn more at https://aka.ms/vm-hbe.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.66d55bd712d1","displayName":"Virtual machines and virtual machine scale sets should have encryption at host enabled","tags":{"Azure.Policy/category":"Compute"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/fc4d8e41-e223-45ea-9bf5-eada37891d87","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Use encryption at host to get end-to-end encryption for your virtual machine and virtual machine scale set data. Encryption at host enables encryption at rest for your temporary disk and OS/data disk caches. Temporary and ephemeral OS disks are encrypted with platform-managed keys when encryption at host is enabled. OS/data disk caches are encrypted at rest with either customer-managed or platform-managed key, depending on the encryption type selected on the disk. Learn more at https://aka.ms/vm-hbe.","type":["Microsoft.Compute/virtualMachines","Microsoft.Compute/virtualMachineScaleSets"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"allOf":[{"equals":"Microsoft.Compute/virtualMachines","type":"."},{"field":"properties.securityProfile.encryptionAtHost","notEquals":"true"}]},{"allOf":[{"equals":"Microsoft.Compute/virtualMachineScaleSets","type":"."},{"field":"properties.virtualMachineProfile.securityProfile.encryptionAtHost","notEquals":"true"}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Disabling public network access improves security by ensuring that your CosmosDB account isn't exposed on the public internet. Creating private endpoints can limit exposure of your CosmosDB account. Learn more at: https://docs.microsoft.com/azure/cosmos-db/how-to-configure-private-endpoints#blocking-public-network-access-during-account-creation.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.259851e7f466","displayName":"Azure Cosmos DB should disable public network access","tags":{"Azure.Policy/category":"Cosmos DB"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/797b37f7-06b8-444c-b1ad-fc62867f335a","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Disabling public network access improves security by ensuring that your CosmosDB account isn't exposed on the public internet. Creating private endpoints can limit exposure of your CosmosDB account. Learn more at: https://docs.microsoft.com/azure/cosmos-db/how-to-configure-private-endpoints#blocking-public-network-access-during-account-creation.","type":["Microsoft.DocumentDB/databaseAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.publicNetworkAccess","equals":"Disabled"}}},{
// Synopsis: Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your CosmosDB account, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/cosmos-db/how-to-configure-private-endpoints.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.f26b8328d08f","displayName":"CosmosDB accounts should use private link","tags":{"Azure.Policy/category":"Cosmos DB"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/58440f8a-10c5-4151-bdce-dfbaad4a20b7","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your CosmosDB account, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/cosmos-db/how-to-configure-private-endpoints.","type":["Microsoft.DocumentDB/databaseAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"less":1,"field":"properties.privateEndpointConnections[*]","allOf":[{"field":"properties.privateLinkServiceConnectionState.status","equals":"Approved"}]}}},{
// Synopsis: Disabling local authentication methods improves security by ensuring that VPN Gateways use only Azure Active Directory identities for authentication. Learn more about Azure AD authentication at https://docs.microsoft.com/azure/vpn-gateway/openvpn-azure-ad-tenant
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.a206f97a07c9","displayName":"VPN gateways should use only Azure Active Directory (Azure AD) authentication for point-to-site users","tags":{"Azure.Policy/category":"Network"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/21a6bc25-125e-4d13-b82d-2e19b7208ab7","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Disabling local authentication methods improves security by ensuring that VPN Gateways use only Azure Active Directory identities for authentication. Learn more about Azure AD authentication at https://docs.microsoft.com/azure/vpn-gateway/openvpn-azure-ad-tenant","type":["Microsoft.Network/virtualNetworkGateways"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"allOf":[{"field":"properties.vpnClientConfiguration.vpnClientAddressPool.addressPrefixes","exists":true},{"greaterOrEqual":1,"field":"properties.vpnClientConfiguration.vpnAuthenticationTypes[*]","allOf":[{"field":".","notcontains":"AAD"}]}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Setting TLS version to 1.2 or newer improves security by ensuring your Azure SQL Database can only be accessed from clients using TLS 1.2 or newer. Using versions of TLS less than 1.2 is not recommended since they have well documented security vulnerabilities.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.1269f6d45880","displayName":"Azure SQL Database should be running TLS version 1.2 or newer","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/32e6bbec-16b6-44c2-be37-c5b672d103cf","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Setting TLS version to 1.2 or newer improves security by ensuring your Azure SQL Database can only be accessed from clients using TLS 1.2 or newer. Using versions of TLS less than 1.2 is not recommended since they have well documented security vulnerabilities.","type":["Microsoft.Sql/servers"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"field":"properties.minimalTlsVersion","exists":false},{"field":"properties.minimalTlsVersion","less":"1.2","convert":true}]},"condition":{"value":"Audit","equals":false}}},{
// Synopsis: Disabling public network access (public endpoint) on Azure SQL Managed Instances improves security by ensuring that they can only be accessed from inside their virtual networks or via Private Endpoints. To learn more about public network access, visit https://aka.ms/mi-public-endpoint.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.831f669657a9","displayName":"Azure SQL Managed Instances should disable public network access","tags":{"Azure.Policy/category":"SQL"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/9dfea752-dd46-4766-aed1-c355fa93fb91","Azure.Policy/version":"1.0.0"}},"spec":{"recommend":"Disabling public network access (public endpoint) on Azure SQL Managed Instances improves security by ensuring that they can only be accessed from inside their virtual networks or via Private Endpoints. To learn more about public network access, visit https://aka.ms/mi-public-endpoint.","type":["Microsoft.Sql/managedInstances"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"condition":{"field":"properties.publicDataEndpointEnabled","notEquals":true}}},{
// Synopsis: Audit requirement of Azure Active Directory (Azure AD) to authorize requests for your storage account. By default, requests can be authorized with either Azure Active Directory credentials, or by using the account access key for Shared Key authorization. Of these two types of authorization, Azure AD provides superior security and ease of use over Shared Key, and is recommended by Microsoft.
"apiVersion":"github.com/microsoft/PSRule/v1","kind":"Rule","metadata":{"name":"Azure.Policy.f698ce87b33f","displayName":"Storage accounts should prevent shared key access","tags":{"Azure.Policy/category":"Storage"},"annotations":{"Azure.Policy/id":"/providers/Microsoft.Authorization/policyDefinitions/8c6a50c6-9ffd-4ae7-986f-5fa6111f9a54","Azure.Policy/version":"2.0.0"}},"spec":{"recommend":"Audit requirement of Azure Active Directory (Azure AD) to authorize requests for your storage account. By default, requests can be authorized with either Azure Active Directory credentials, or by using the account access key for Shared Key authorization. Of these two types of authorization, Azure AD provides superior security and ease of use over Shared Key, and is recommended by Microsoft.","type":["Microsoft.Storage/storageAccounts"],"with":["PSRule.Rules.Azure\\Azure.Policy.Indexed"],"where":{"anyOf":[{"anyOf":[{"field":"properties.allowSharedKeyAccess","exists":false},{"field":"properties.allowSharedKeyAccess","equals":""}]},{"field":"properties.allowSharedKeyAccess","equals":"true"}]},"condition":{"value":"Audit","equals":false}}}]